import{r as l,j as e,D as A,Z as f,_ as N,$ as w,a0 as v,a1 as L,a2 as I,a3 as T,a4 as V,a5 as $,a6 as B,a7 as F,a8 as O}from"./index-VlY56Sk6.js";import{c as S}from"./balance-D50WTyd9.js";function G(){const m=JSON.parse(localStorage.getItem("DaherUser")||"{}"),[o,x]=l.useState(m.username||"elidaher"),[d,k]=l.useState(new Date().toISOString().split("T")[0]),[c,h]=l.useState([]),[D,E]=l.useState(["all"]),[p,u]=l.useState(!1),[g,y]=l.useState(!1),b=l.useCallback(async a=>{y(!0);try{const r=await S("all",a),s=Array.isArray(r==null?void 0:r.data)?r.data:[],n=Array.from(new Set(s.map(t=>t.employee).filter(t=>typeof t=="string"&&t.trim()!==""))),i=["all",...n];E(i),i.includes(o)||(n.length>0?x(n[0]):x("all"))}catch(r){console.error("Failed to load employees:",r)}finally{y(!1)}},[o]),j=l.useCallback(async(a,r)=>{u(!0);try{const s=await S(a,r),i=(Array.isArray(s==null?void 0:s.data)?s.data:[]).map(t=>({...t,employee:t.employee??(a!=="all"?a:void 0),amount:Number(t.amount)||0}));h(i)}catch(s){console.error(s),h([])}finally{u(!1)}},[]);l.useEffect(()=>{b(d)},[d,b]),l.useEffect(()=>{j(o,d),console.log(c)},[o,d,j]);const C=c.reduce((a,r)=>a+(r.amount||0),0);return e.jsx(A,{children:e.jsxs("div",{dir:"rtl",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"البيان المالي"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(f,{children:[e.jsx(N,{asChild:!0,children:e.jsxs("button",{className:"border border-gray-300 rounded-lg px-4 py-2 text-foreground flex items-center gap-2 hover:bg-foreground/30","aria-label":"اختر التاريخ",children:[d,e.jsx(w,{className:"w-4 h-4"})]})}),e.jsx(v,{sideOffset:8,className:"bg-background shadow-lg rounded-lg p-4 border border-gray-200",children:e.jsx("input",{type:"date",value:d,onChange:a=>k(a.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 w-full bg-background"})})]}),m.role=="admin"&&e.jsxs(L,{value:o,onValueChange:a=>x(a),disabled:g,children:[e.jsxs(I,{className:"border border-gray-300 rounded-lg px-4 py-2 flex items-center justify-between gap-2 w-40 disabled:opacity-50 hover:bg-foreground/30","aria-label":"اختر الموظف",children:[e.jsx(T,{placeholder:g?"...":"اختر الموظف"}),e.jsx(V,{children:e.jsx(w,{className:"w-4 h-4"})})]}),e.jsx($,{className:"bg-background border border-gray-200 rounded-lg shadow-md max-h-56 overflow-y-auto",children:e.jsx(B,{children:D.map(a=>e.jsx(F,{value:a,className:"px-4 py-2 hover:bg-foreground/30 cursor-pointer",children:e.jsx(O,{children:a==="all"?"جميع الموظفين":a})},a))})})]})]})]}),e.jsx("div",{className:"bg-background rounded-xl shadow-md overflow-x-auto",children:p?e.jsx("div",{className:"p-6 text-center text-foreground",children:"جاري التحميل..."}):c.length===0?e.jsx("div",{className:"p-6 text-center text-foreground",children:"لا توجد بيانات"}):e.jsxs("table",{className:"min-w-full text-sm text-foreground",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-foreground/20 text-foreground text-right",children:[e.jsx("th",{className:"py-3 px-4",children:"#"}),o==="all"&&e.jsx("th",{className:"py-3 px-4",children:"الموظف"}),e.jsx("th",{className:"py-3 px-4",children:"التفاصيل"}),e.jsx("th",{className:"py-3 px-4",children:"المبلغ"}),e.jsx("th",{className:"py-3 px-4",children:"التاريخ"})]})}),e.jsx("tbody",{children:c.map((a,r)=>e.jsxs("tr",{className:"border-b hover:bg-foreground/20 transition",children:[e.jsx("td",{className:"py-3 px-4",children:r+1}),o==="all"&&e.jsx("th",{className:"py-3 px-4",children:a.employee}),e.jsx("td",{className:"py-3 px-4",children:Array.isArray(a.details)&&a.details.length>0?e.jsxs(f,{children:[e.jsx(N,{asChild:!0,children:e.jsx("button",{className:"text-foreground hover:underline",children:a.details.map(s=>e.jsx("p",{children:s.customerName+" // "+s.customerNumber}))})}),e.jsx(v,{side:"bottom",align:"start",className:"bg-background border border-gray-200 rounded-lg shadow-lg p-4 max-w-lg",children:e.jsxs("table",{className:"text-sm w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-foreground/30 text-foreground",children:[e.jsx("th",{className:"border px-2 py-1",children:"العميل"}),e.jsx("th",{className:"border px-2 py-1",children:"الهاتف"}),e.jsx("th",{className:"border px-2 py-1",children:"رقم الفاتورة"}),e.jsx("th",{className:"border px-2 py-1",children:"القيمة"}),e.jsx("th",{className:"border px-2 py-1",children:"ملاحظات"})]})}),e.jsx("tbody",{children:a.details.map((s,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:s.customerName}),e.jsx("td",{className:"border px-2 py-1",children:s.customerNumber}),e.jsx("td",{className:"border px-2 py-1",children:s.invoiceNumber}),e.jsx("td",{className:"border px-2 py-1",children:s.invoiceValue}),e.jsx("td",{className:"border px-2 py-1",children:s.customerDetails})]},n))})]})})]}):e.jsx("span",{className:"text-gray-400",children:"لا تفاصيل"})}),e.jsx("td",{className:"py-3 px-4 text-blue-600 dark:text-primary-300 font-semibold",children:a.amount.toLocaleString("en-EG",{minimumFractionDigits:0})}),e.jsx("td",{className:"py-3 px-4",children:a.timestamp})]},a.id))})]})}),!p&&c.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"bg-foreground/10 px-6 py-3 rounded-lg text-blue-700 dark:text-primary-300 font-bold shadow dark:shadow-lg dark:shadow-white/15",children:["الإجمالي:"," ",C.toLocaleString("en-EG",{minimumFractionDigits:0})]})})]})})}export{G as default};
