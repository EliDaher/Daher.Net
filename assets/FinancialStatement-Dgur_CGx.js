import{r as p,j as e,J as n}from"./index-BgjzOHka.js";import{u as v}from"./useMutation-b-dUq8l8.js";import{D as C}from"./DashboardLayout-P3XUXwj6.js";import{C as u,a as j,b,c as N}from"./card-BeiAbVYm.js";import{B as D}from"./button-BrQsrS7q.js";import{F as S}from"./FormInput-jU1o1Mi-.js";import{h as w}from"./invoices-Cn0FCuk6.js";import{R as F,T as R,C as T}from"./index-iV3Hb-y0.js";import"./house-CzX8uGDh.js";import"./input-DBlcqyhk.js";function O(){const[t,g]=p.useState(""),[c,o]=p.useState([]),a=v({mutationFn:async()=>{if(!t.trim()){n.error("الرجاء إدخال كلمة للبحث");return}return await w(t)},onSuccess:s=>{!s||s.message?(o([]),n.error("لا توجد نتائج مطابقة")):(console.log("Search Results:",s),o(s))},onError:s=>{console.error(s),n.error("حدث خطأ أثناء تنفيذ البحث")}}),y=()=>{a.mutate()};return e.jsx(C,{children:e.jsxs("div",{dir:"rtl",className:"p-4 space-y-4",children:[e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(b,{children:"البحث في الفواتير (البيان المالي)"})}),e.jsx(N,{className:"space-y-3",children:e.jsxs("form",{className:"flex",onSubmit:s=>{s.preventDefault(),y()},children:[e.jsx(S,{label:"",id:"BillSearch",type:"text",value:t,onChange:s=>g(s.target.value),placeholder:"أدخل اسم الزبون أو رقم الفاتورة",className:"w-full rounded-l-none"}),e.jsx(D,{type:"submit",disabled:a.isPending,className:"mt-1 rounded-r-none",children:a.isPending?"جاري البحث...":"بحث"})]})})]}),c.length>0&&e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(b,{children:"نتائج البحث"})}),e.jsx(N,{children:e.jsx("div",{className:"bg-background rounded-xl shadow-md overflow-x-auto",children:a.isPending?e.jsx("div",{className:"p-6 text-center text-foreground",children:"جاري التحميل..."}):e.jsxs("table",{className:"min-w-full text-sm text-foreground",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-foreground/20 text-foreground text-right",children:[e.jsx("th",{className:"py-3 px-4",children:"#"}),e.jsx("th",{className:"py-3 px-4",children:"الموظف"}),e.jsx("th",{className:"py-3 px-4",children:"التفاصيل"}),e.jsx("th",{className:"py-3 px-4",children:"المبلغ"}),e.jsx("th",{className:"py-3 px-4",children:"التاريخ"})]})}),e.jsx("tbody",{children:c.map((s,i)=>{var d,m,x,h;const l=(d=s.invoiceData)!=null&&d.details?Object.values(s.invoiceData.details):[];return e.jsxs("tr",{className:"border-b hover:bg-foreground/20 transition",children:[e.jsx("td",{className:"py-3 px-4",children:i+1}),e.jsx("td",{className:"py-3 px-4 font-medium",children:s.employee}),e.jsx("td",{className:"py-3 px-4",children:l.length>0?e.jsxs(F,{children:[e.jsx(R,{asChild:!0,children:e.jsx("button",{className:"text-accent hover:underline",children:l.map(r=>r.customerName+"//"+r.invoiceNumber+"//"+r.customerDetails).join(", ")})}),e.jsx(T,{side:"bottom",align:"start",className:"bg-background border border-gray-200 rounded-lg shadow-lg p-4 max-w-lg",children:e.jsxs("table",{className:"text-sm w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-foreground/30 text-foreground",children:[e.jsx("th",{className:"border px-2 py-1",children:"العميل"}),e.jsx("th",{className:"border px-2 py-1",children:"الرقم"}),e.jsx("th",{className:"border px-2 py-1",children:"رقم الفاتورة"}),e.jsx("th",{className:"border px-2 py-1",children:"القيمة"}),e.jsx("th",{className:"border px-2 py-1",children:"الملاحظات"})]})}),e.jsx("tbody",{children:l.map((r,f)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:r.customerName}),e.jsx("td",{className:"border px-2 py-1",children:r.customerNumber}),e.jsx("td",{className:"border px-2 py-1",children:r.invoiceNumber}),e.jsx("td",{className:"border px-2 py-1",children:r.invoiceValue}),e.jsx("td",{className:"border px-2 py-1",children:r.customerDetails})]},f))})]})})]}):e.jsx("span",{className:"text-gray-400",children:"لا تفاصيل"})}),e.jsx("td",{className:"py-3 px-4 text-blue-600 font-semibold",children:(x=(m=s.invoiceData)==null?void 0:m.amount)==null?void 0:x.toLocaleString("en-EG",{minimumFractionDigits:0})}),e.jsx("td",{className:"py-3 px-4",children:((h=s.invoiceData)==null?void 0:h.timestamp)||s.date})]},i)})})]})})})]})]})})}export{O as default};
