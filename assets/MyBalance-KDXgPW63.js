import{r as l,j as e,D as A,S as f}from"./index-D1KU1fLZ.js";import{c as N}from"./balance-CY01OX6M.js";import{R as T,T as I,V as L,I as R,C as V,a as B,b as F,c as O}from"./index-X6BLs-Px.js";import{R as w,T as v,C as S}from"./index-BVSYm7kl.js";function J(){const m=JSON.parse(localStorage.getItem("DaherUser")||"{}"),[o,x]=l.useState(m.username||"elidaher"),[d,k]=l.useState(new Date().toISOString().split("T")[0]),[c,h]=l.useState([]),[C,D]=l.useState(["all"]),[p,u]=l.useState(!1),[g,y]=l.useState(!1),b=l.useCallback(async s=>{y(!0);try{const r=await N("all",s),a=Array.isArray(r==null?void 0:r.data)?r.data:[],n=Array.from(new Set(a.map(t=>t.employee).filter(t=>typeof t=="string"&&t.trim()!==""))),i=["all",...n];D(i),i.includes(o)||(n.length>0?x(n[0]):x("all"))}catch(r){console.error("Failed to load employees:",r)}finally{y(!1)}},[o]),j=l.useCallback(async(s,r)=>{u(!0);try{const a=await N(s,r),i=(Array.isArray(a==null?void 0:a.data)?a.data:[]).map(t=>({...t,employee:t.employee??(s!=="all"?s:void 0),amount:Number(t.amount)||0}));h(i)}catch(a){console.error(a),h([])}finally{u(!1)}},[]);l.useEffect(()=>{b(d)},[d,b]),l.useEffect(()=>{j(o,d),console.log(c)},[o,d,j]);const E=c.reduce((s,r)=>s+(r.amount||0),0);return e.jsx(A,{children:e.jsxs("div",{dir:"rtl",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"البيان المالي"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(w,{children:[e.jsx(v,{asChild:!0,children:e.jsxs("button",{className:"border border-gray-300 rounded-lg px-4 py-2 text-foreground flex items-center gap-2 hover:bg-foreground/30","aria-label":"اختر التاريخ",children:[d,e.jsx(f,{className:"w-4 h-4"})]})}),e.jsx(S,{sideOffset:8,className:"bg-background shadow-lg rounded-lg p-4 border border-gray-200",children:e.jsx("input",{type:"date",value:d,onChange:s=>k(s.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 w-full bg-background"})})]}),m.role=="admin"&&e.jsxs(T,{value:o,onValueChange:s=>x(s),disabled:g,children:[e.jsxs(I,{className:"border border-gray-300 rounded-lg px-4 py-2 flex items-center justify-between gap-2 w-40 disabled:opacity-50 hover:bg-foreground/30","aria-label":"اختر الموظف",children:[e.jsx(L,{placeholder:g?"...":"اختر الموظف"}),e.jsx(R,{children:e.jsx(f,{className:"w-4 h-4"})})]}),e.jsx(V,{className:"bg-background border border-gray-200 rounded-lg shadow-md max-h-56 overflow-y-auto",children:e.jsx(B,{children:C.map(s=>e.jsx(F,{value:s,className:"px-4 py-2 hover:bg-foreground/30 cursor-pointer",children:e.jsx(O,{children:s==="all"?"جميع الموظفين":s})},s))})})]})]})]}),e.jsx("div",{className:"bg-background rounded-xl shadow-md overflow-x-auto",children:p?e.jsx("div",{className:"p-6 text-center text-foreground",children:"جاري التحميل..."}):c.length===0?e.jsx("div",{className:"p-6 text-center text-foreground",children:"لا توجد بيانات"}):e.jsxs("table",{className:"min-w-full text-sm text-foreground",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-foreground/20 text-foreground text-right",children:[e.jsx("th",{className:"py-3 px-4",children:"#"}),o==="all"&&e.jsx("th",{className:"py-3 px-4",children:"الموظف"}),e.jsx("th",{className:"py-3 px-4",children:"التفاصيل"}),e.jsx("th",{className:"py-3 px-4",children:"المبلغ"}),e.jsx("th",{className:"py-3 px-4",children:"التاريخ"})]})}),e.jsx("tbody",{children:c.map((s,r)=>e.jsxs("tr",{className:"border-b hover:bg-foreground/20 transition",children:[e.jsx("td",{className:"py-3 px-4",children:r+1}),o==="all"&&e.jsx("th",{className:"py-3 px-4",children:s.employee}),e.jsx("td",{className:"py-3 px-4",children:Array.isArray(s.details)&&s.details.length>0?e.jsxs(w,{children:[e.jsx(v,{asChild:!0,children:e.jsx("button",{className:"text-foreground hover:underline",children:s.details.map(a=>e.jsx("p",{children:a.customerName+" // "+a.customerNumber}))})}),e.jsx(S,{side:"bottom",align:"start",className:"bg-background border border-gray-200 rounded-lg shadow-lg p-4 max-w-lg",children:e.jsxs("table",{className:"text-sm w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-foreground/30 text-foreground",children:[e.jsx("th",{className:"border px-2 py-1",children:"العميل"}),e.jsx("th",{className:"border px-2 py-1",children:"الهاتف"}),e.jsx("th",{className:"border px-2 py-1",children:"رقم الفاتورة"}),e.jsx("th",{className:"border px-2 py-1",children:"القيمة"}),e.jsx("th",{className:"border px-2 py-1",children:"ملاحظات"})]})}),e.jsx("tbody",{children:s.details.map((a,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:a.customerName}),e.jsx("td",{className:"border px-2 py-1",children:a.customerNumber}),e.jsx("td",{className:"border px-2 py-1",children:a.invoiceNumber}),e.jsx("td",{className:"border px-2 py-1",children:a.invoiceValue}),e.jsx("td",{className:"border px-2 py-1",children:a.customerDetails})]},n))})]})})]}):e.jsx("span",{className:"text-gray-400",children:"لا تفاصيل"})}),e.jsx("td",{className:"py-3 px-4 text-blue-600 dark:text-primary-300 font-semibold",children:s.amount.toLocaleString("en-EG",{minimumFractionDigits:0})}),e.jsx("td",{className:"py-3 px-4",children:s.timestamp})]},s.id))})]})}),!p&&c.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"bg-foreground/10 px-6 py-3 rounded-lg text-blue-700 dark:text-primary-300 font-bold shadow dark:shadow-lg dark:shadow-white/15",children:["الإجمالي:"," ",E.toLocaleString("en-EG",{minimumFractionDigits:0})]})})]})})}export{J as default};
