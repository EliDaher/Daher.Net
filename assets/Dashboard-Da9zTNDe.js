import{r as n,j as e,c as re,P as T,a as D,d as R,m as ce,e as le,f as P}from"./index-DeUUlL9l.js";import{a as de,u as ue,b as me,c as $,R as fe,I as pe,P as ge,D as xe,U as ve}from"./DashboardLayout-BPlQhhSI.js";import{S as k}from"./StatsCard-DLrksVhG.js";import{C as j}from"./ChartContainer-CLdluTNf.js";import{C as B,a as E,b as F,c as L}from"./card-B7FlCwkI.js";import{g as be}from"./wifi-D_fU9QAN.js";import{g as _,a as he}from"./balance-BthrWZY_.js";import{L as ye,A as je,D as Ne,d as Ce}from"./DatePicker-BAQgg1Xq.js";import{g as Te}from"./invoices-DO2Js6zg.js";import{l as we}from"./index-BLRFddlS.js";import{C as K}from"./credit-card-DJWNdhIw.js";import{a as V}from"./button-BbuLOj8Q.js";import{D as Se}from"./DemoContainer-BDYFW1Pa.js";import"./house-tY2-Z_zD.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=V("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=V("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);var M="Tabs",[Re,Qe]=re(M,[$]),q=$(),[Me,A]=Re(M),G=n.forwardRef((a,o)=>{const{__scopeTabs:c,value:l,onValueChange:u,defaultValue:p,orientation:d="horizontal",dir:g,activationMode:v="automatic",...b}=a,f=de(g),[m,x]=ue({prop:l,onChange:u,defaultProp:p});return e.jsx(Me,{scope:c,baseId:me(),value:m,onValueChange:x,orientation:d,dir:f,activationMode:v,children:e.jsx(T.div,{dir:f,"data-orientation":d,...b,ref:o})})});G.displayName=M;var U="TabsList",H=n.forwardRef((a,o)=>{const{__scopeTabs:c,loop:l=!0,...u}=a,p=A(U,c),d=q(c);return e.jsx(fe,{asChild:!0,...d,orientation:p.orientation,dir:p.dir,loop:l,children:e.jsx(T.div,{role:"tablist","aria-orientation":p.orientation,...u,ref:o})})});H.displayName=U;var z="TabsTrigger",O=n.forwardRef((a,o)=>{const{__scopeTabs:c,value:l,disabled:u=!1,...p}=a,d=A(z,c),g=q(c),v=W(d.baseId,l),b=J(d.baseId,l),f=l===d.value;return e.jsx(pe,{asChild:!0,...g,focusable:!u,active:f,children:e.jsx(T.button,{type:"button",role:"tab","aria-selected":f,"aria-controls":b,"data-state":f?"active":"inactive","data-disabled":u?"":void 0,disabled:u,id:v,...p,ref:o,onMouseDown:D(a.onMouseDown,m=>{!u&&m.button===0&&m.ctrlKey===!1?d.onValueChange(l):m.preventDefault()}),onKeyDown:D(a.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&d.onValueChange(l)}),onFocus:D(a.onFocus,()=>{const m=d.activationMode!=="manual";!f&&!u&&m&&d.onValueChange(l)})})})});O.displayName=z;var Y="TabsContent",Q=n.forwardRef((a,o)=>{const{__scopeTabs:c,value:l,forceMount:u,children:p,...d}=a,g=A(Y,c),v=W(g.baseId,l),b=J(g.baseId,l),f=l===g.value,m=n.useRef(f);return n.useEffect(()=>{const x=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(x)},[]),e.jsx(ge,{present:u||f,children:({present:x})=>e.jsx(T.div,{"data-state":f?"active":"inactive","data-orientation":g.orientation,role:"tabpanel","aria-labelledby":v,hidden:!x,id:b,tabIndex:0,...d,ref:o,style:{...a.style,animationDuration:m.current?"0s":void 0},children:x&&p})})});Q.displayName=Y;function W(a,o){return`${a}-trigger-${o}`}function J(a,o){return`${a}-content-${o}`}var Ae=G,Z=H,X=O,ee=Q;const Ie=Ae,te=n.forwardRef(({className:a,...o},c)=>e.jsx(Z,{ref:c,className:R("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...o}));te.displayName=Z.displayName;const N=n.forwardRef(({className:a,...o},c)=>e.jsx(X,{ref:c,className:R("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...o}));N.displayName=X.displayName;const C=n.forwardRef(({className:a,...o},c)=>e.jsx(ee,{ref:c,className:R("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...o}));C.displayName=ee.displayName;function We(){const a=ce(),o=JSON.parse(localStorage.getItem("DaherUser")),[c,l]=n.useState(0),[u,p]=n.useState([]),[d,g]=n.useState([]),[v,b]=n.useState(""),[f,m]=n.useState(null),x=le(),{data:h,isLoading:Pe}=P({queryKey:["pending-table"],queryFn:Te});n.useEffect(()=>{"Notification"in window&&Notification.requestPermission().then(t=>{console.log("Notification permission:",t)})},[]);const I=n.useRef([]);n.useEffect(()=>{if(h&&h.length>0){const t=I.current,s=h.filter(r=>!t.some(y=>y._id===r._id));s.length>0&&(new Notification("طلب دفع جديد",{body:`المبلغ: ${s[0].amount} - الشركة: ${s[0].company}`,icon:"/logo.png"}),new Audio("../../public/notification.mp3").play()),I.current=h}},[h]),n.useEffect(()=>{const t=we("https://paynet-1.onrender.com");return m(t),t.on("pendingPaymentsUpdate",s=>{x.setQueryData(["pending-table"],s)}),()=>{t.disconnect()}},[x]);const ae=async()=>{const t=await _("");t!=null&&t.success?g(t.BalanceTable):console.error(t)},{data:i,isLoading:Be}=P({queryKey:["customers-table"],queryFn:be,select:t=>t?o.role==="dealer"?t.filter(s=>s.dealer==="habeb"):t:[]}),se=async()=>{const t=await he("");t!=null&&t.success?p(t.BalanceTable):console.log((t==null?void 0:t.error)||"فشل جلب البيانات"),console.log(t)};n.useEffect(()=>{se()},[]);const w=n.useMemo(()=>i==null?void 0:i.reduce((t,s)=>t+Number(s.SubscriptionSpeed),0),[i]),ne=n.useMemo(()=>{var s;const t=(s=i==null?void 0:i.filter(r=>r.Balance<0))==null?void 0:s.reduce((r,y)=>r+Number(y.Balance),0);return Math.abs(t)},[i]);n.useEffect(()=>{let t=0;u.forEach(s=>{t+=s.total}),l(t)},[u]);const oe=n.useMemo(()=>{if(!i)return[];const t={};return i.forEach(s=>{const r=(s==null?void 0:s.SubscriptionSpeed)||"غير محددة";t[r]||(t[r]={name:`${r} Mbps`,value:0}),t[r].value+=1}),Object.values(t)},[i]);return e.jsx(xe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Welcome back! Here's what's happening with your business today."})]}),e.jsxs("div",{dir:"rtl",className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(k,{onClick:()=>{a("/users")},title:"عدد مشتركين الفضائي",value:(i==null?void 0:i.length)||0,icon:ve}),e.jsx(k,{onClick:()=>{a("/users",{state:"unpaid"})},title:"ديون الفضائي",value:ne||0,icon:K}),o.role!="admin"?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsx(k,{onClick:()=>{a("/PendingTransactions")},title:"الفواتير الغير مدفوعة",value:h?h.length:0,icon:ke})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 text-center",children:[e.jsx(j,{className:"mdL:col-span-2",title:" توزع المرسلات ",data:i==null?void 0:i.reduce((t,s)=>{const r=(s.sender??"").trim(),y=Number(s.SubscriptionSpeed),S=t.find(ie=>ie.sender===r);return S?(S.totalSpeed+=y,S.customerCount+=1):t.push({sender:r,totalSpeed:y,customerCount:1}),t},[]),type:"bar",dataKey2:"customerCount",dataKey:"totalSpeed"}),o.role!="admin"?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsx(j,{title:"صناديق اليوم",data:u,type:"line",dataKey2:"count",desc:c.toString(),dataKey:"total"})}),e.jsx(j,{title:"عدد المشتركين حسب السرعة",type:"pie",dataKey:"value",data:oe,desc:(w==null?void 0:w.toString())+" Mbps"})]}),o.role!="admin"?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsxs(Ie,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(te,{children:[e.jsx(N,{value:"overview",children:"Overview"}),e.jsx(N,{onClick:ae,value:"analytics",children:"Analytics"}),e.jsx(N,{value:"reports",children:"Reports"})]}),e.jsx(C,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs(B,{children:[e.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Active Users"}),e.jsx(De,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"2,350"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+180.1% from last month"})]})]}),e.jsxs(B,{children:[e.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"$45,231.89"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+20.1% from last month"})]})]}),e.jsx(j,{title:"Revenue Distribution",data:(i==null?void 0:i.slice(0,4))||[],type:"pie",dataKey:"revenue"})]})}),e.jsx(C,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{className:"bg-background/80 text-foreground",children:e.jsx(ye,{dateAdapter:je,children:e.jsx(Se,{components:["DatePicker","DatePicker","DatePicker"],children:e.jsx(Ne,{views:["month","year"],value:Ce(v),onChange:t=>{const s=t.format("YYYY-MM");b(s),_(s).then(r=>{r!=null&&r.success&&g(r.BalanceTable)})}})})})}),e.jsx(j,{title:"صناديق الشهر الحالي",data:d||[],type:"stackBar",dataKey:"users"})]})}),e.jsx(C,{value:"reports",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Reports Coming Soon"}),e.jsx("p",{className:"text-muted-foreground",children:"Advanced reporting features will be available soon."})]})})]})})]})})}export{We as default};
