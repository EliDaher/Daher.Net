import{c as O,l as h,r as l,j as e,D as x,p as f}from"./index-G6UPpXlA.js";import{S as g}from"./StatsCard-C3wSpH7K.js";import{A}from"./AddBalanceForm-CtlRnK2e.js";import{d as C,c as I}from"./balance-CUzTyI46.js";import{P}from"./plus-Dfa1sYt_.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=O("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);function V(){const{data:s,isLoading:B}=h({queryKey:["dailyBalance-table"],queryFn:C}),{data:t,isLoading:q}=h({queryKey:["todayBalance-table"],queryFn:()=>I("all",new Date().toISOString().split("T")[0])}),j=[{key:"total",label:"الكمية",sortable:!0},{key:"date",label:"الوقت",sortable:!0}],v=[{key:"employee",label:"الموظف",sortable:!0},{key:"total",label:"الكمية",sortable:!0}],[i,E]=l.useState(0),[c,S]=l.useState(0),[d,N]=l.useState([]),[k,m]=l.useState(!1),[F,u]=l.useState("pay"),y=()=>m(!1),p=()=>m(!0),L=()=>{y()};return l.useEffect(()=>{if(s&&t){let n=0;s.forEach(a=>{n+=a.total}),t.data.forEach(a=>{n+=a.amount}),E(n);let b=0;t.data.forEach(a=>{a.employee!="mahal"&&(b+=a.amount)}),S(b);const w=t.data.reduce((a,o)=>{const r=o.employee;return a[r]||(a[r]=0),a[r]+=o.amount,a},{}),D=Object.entries(w).map(([a,o])=>({employee:a,total:o}));N(D)}},[s,t]),l.useEffect(()=>{console.log(t)},[t]),B?e.jsx(x,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(e.Fragment,{children:[e.jsx(x,{children:e.jsxs("div",{dir:"rtl",className:"space-y-6",children:[e.jsxs("div",{dir:"rtl",className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx(g,{title:"الرصيد الحالي",value:i.toLocaleString("en-EG",{minimumFractionDigits:0})||0,description:"",icon:T,className:"rounded-b-none"}),e.jsxs("div",{className:"w-full",children:[e.jsx("button",{onClick:()=>{u("pay"),p()},className:"p-2 w-1/2 bg-primary-500 text-white rounded-br hover:bg-primary-600",children:"قبض"}),e.jsx("button",{onClick:()=>{u("inv"),p()},className:"p-2 w-1/2 bg-red-500 text-white rounded-bl hover:bg-red-600",children:"دفع"})]})]})}),e.jsx(g,{title:"صناديق اليوم",value:c.toLocaleString("en-EG",{minimumFractionDigits:0})||0,description:"",icon:P})]}),e.jsx(f,{title:"الرصيد",description:`المجموع ${(i-c).toLocaleString("en-EG",{minimumFractionDigits:0})}`,columns:j,data:s?s.reverse():[]}),e.jsx(f,{searchable:!1,title:"",description:"",columns:v,data:d||[]})]})}),e.jsx(A,{mahal:!0,payOrInv:F,isOpen:k,onClose:y,onSubmit:L})]})}export{V as default};
