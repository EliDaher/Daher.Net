import{r as l,l as A,j as e,D as x,C as O,m as q,o as I,S as j,x as f,y as p,z as b,A as r,ab as V,ac as z,B,ad as P,ae as $,p as F}from"./index-DjOO9HL0.js";import{b as H}from"./invoices-BWwmUYli.js";function G(){const[s,C]=l.useState(void 0),[o,g]=l.useState("all"),[c,w]=l.useState("all"),[i,D]=l.useState("all"),[m,K]=l.useState(""),u=s!=null&&s.from?new Date(s.from.getTime()+Math.abs(s.from.getTimezoneOffset()*6e4)).toISOString().split("T")[0]:"",d=s!=null&&s.to?new Date(s.to.getTime()+Math.abs(s.to.getTimezoneOffset()*6e4)).toISOString().split("T")[0]:"",{data:n=[],isLoading:T,isError:N}=A({queryKey:["done-invoices",u,d],queryFn:()=>H(u,d),enabled:!!u&&!!d}),h=l.useMemo(()=>n.filter(t=>o==="all"?!0:t.company===o).filter(t=>i==="all"?!0:t.status===i).filter(t=>c==="all"?!0:t.email===c).filter(t=>{var y,S,v;if(!m)return!0;const a=m.toLowerCase();return((y=t.landline)==null?void 0:y.toLowerCase().includes(a))||((S=t.email)==null?void 0:S.toLowerCase().includes(a))||((v=t.note)==null?void 0:v.toLowerCase().includes(a))}),[n,o,c,i,m]),k=[{key:"_id",label:"المعرف",sortable:!0,hidden:!0},{key:"landline",label:"الرقم",sortable:!0},{key:"company",label:"الشركة",sortable:!0},{key:"speed",label:"السرعة",sortable:!0},{key:"email",label:"الحساب المرسل",sortable:!0},{key:"amount",label:"المبلغ المسدد",sortable:!0},{key:"status",label:"حالة العملية",sortable:!0},{key:"paymentMethod",label:"طريقة الدفع",sortable:!0},{key:"note",label:"ملاحظات",sortable:!0},{key:"createdAt",label:"تاريخ العملية",sortable:!0}],L=l.useMemo(()=>{const t=new Set;return n.forEach(a=>{a.company&&t.add(a.company)}),Array.from(t)},[n]),M=l.useMemo(()=>{const t=new Set;return n.forEach(a=>{a.email&&t.add(a.email)}),Array.from(t)},[n]),E=l.useMemo(()=>h.reduce((t,a)=>(a.amount&&(t+=a.amount),t),0),[h]);return T?e.jsx(x,{children:e.jsx("div",{dir:"rtl",className:"flex h-[70vh] items-center justify-center text-lg font-semibold",children:"جارِ تحميل البيانات..."})}):N?e.jsx(x,{children:e.jsx("div",{dir:"rtl",className:"flex h-[70vh] items-center justify-center text-red-600 text-lg font-semibold",children:"حدث خطأ أثناء تحميل البيانات"})}):e.jsx(x,{children:e.jsxs("div",{dir:"rtl",className:"space-y-6",children:[e.jsxs(O,{className:"p-2 space-y-4",children:[e.jsx(q,{className:"text-3xl font-semibold",children:"الفلاتر"}),e.jsxs(I,{className:"flex flex-wrap gap-4",children:[e.jsxs(j,{value:o,onValueChange:g,children:[e.jsx(f,{className:"w-40",children:e.jsx(p,{placeholder:"الشركة"})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"الكل"}),L.map(t=>e.jsx(r,{value:t,children:t},t))]})]}),e.jsxs(j,{value:c,onValueChange:w,children:[e.jsx(f,{className:"w-40",children:e.jsx(p,{placeholder:"الشركة"})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"الكل"}),M.map(t=>e.jsx(r,{value:t,children:t},t))]})]}),e.jsxs(j,{value:i,onValueChange:D,children:[e.jsx(f,{className:"w-40",children:e.jsx(p,{placeholder:"الحالة"})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"الكل"}),e.jsx(r,{value:"تم التسديد",children:"تم التسديد"}),e.jsx(r,{value:"غير مسددة",children:"غير مسددة"}),e.jsx(r,{value:"مرفوضة",children:"مرفوضة"})]})]}),e.jsxs(V,{children:[e.jsx(z,{asChild:!0,children:e.jsx(B,{variant:"outline",className:"whitespace-nowrap",children:s!=null&&s.from&&(s!=null&&s.to)?`من ${u} إلى ${d}`:"اختر المدة الزمنية"})}),e.jsx(P,{className:"w-auto p-0",align:"start",children:e.jsx($,{initialFocus:!0,mode:"range",selected:s,onSelect:C,numberOfMonths:2})})]})]})]}),e.jsx(F,{title:"التسديدات المنتهية",description:`إجمالي المبلغ: ${E.toLocaleString()}`,columns:k,data:h})]})})}export{G as default};
