import{r as l,s as O,j as e,q as v,J as x}from"./index-BgjzOHka.js";import{D as ae}from"./DashboardLayout-P3XUXwj6.js";import{C as A,a as F,b as L,c as T,e as M,d as re}from"./card-BeiAbVYm.js";import{a as ne,B as d}from"./button-BrQsrS7q.js";import{D as U}from"./DataTable-DgfOsqsb.js";import{D as ce}from"./DetailsInputs-B1iNtNAx.js";import{P as le}from"./PopupForm-DcJrxY53.js";import{I as z}from"./input-DBlcqyhk.js";import{d as ie,L as oe,A as de,D as me}from"./DatePicker-C-vUY6Om.js";import{P as E}from"./plus-Uw6NWjqK.js";import"./house-CzX8uGDh.js";import"./wifi-C3D413KV.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=ne("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function pe({initialItems:p=[],products:m=[]}){const[g,y]=l.useState(!0),[u,j]=l.useState([]);l.useEffect(()=>{j(p.map(n=>({...n})))},[p]);const b=O().id,f=(n,c,a)=>{const o=[...u];o[n]={...o[n],[c]:a},j(o)},N=n=>{j(u.filter((c,a)=>a!==n))},C=[{key:"name",label:"Name",sortable:!0},{key:"price",label:"Price",sortable:!0},{key:"category",label:"Category"},{key:"stock",label:"Stock"},{key:"description",label:"Description"}],w=async()=>{var n,c;try{await v.put(`https://paynet-1.onrender.com/api/invoice/add-bill-items/${b}`,{items:u,initialItems:p}),x.success("تم حفظ العناصر بنجاح"),y(!1)}catch(a){console.error(a),x.error(((c=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:c.message)||"حدث خطأ أثناء الحفظ")}};return e.jsxs("div",{children:[g&&e.jsxs("form",{onSubmit:w,className:"mt-4 space-y-4 p-4 border rounded",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"ادخل بيانات العناصر"}),u.map((n,c)=>e.jsxs("div",{className:"grid grid-cols-4 gap-2 items-center border-b py-2",children:[e.jsx("input",{type:"text",placeholder:"اسم المنتج",value:n.name,onChange:a=>f(c,"name",a.target.value),className:"border p-1 rounded col-span-1"}),e.jsx("input",{type:"number",placeholder:"السعر",value:n.price,onChange:a=>f(c,"price",Number(a.target.value)),className:"border p-1 rounded col-span-1"}),e.jsx("input",{type:"number",placeholder:"الكمية",value:n.stock,onChange:a=>f(c,"stock",Number(a.target.value)),className:"border p-1 rounded col-span-1"}),e.jsx(d,{type:"button",variant:"destructive",size:"sm",onClick:()=>N(c),children:"حذف"})]},c)),e.jsx("div",{className:"flex justify-between mt-2",children:e.jsx(d,{type:"submit",variant:"accent",children:"حفظ العناصر"})})]}),e.jsx("div",{children:m&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-2 mt-4",children:"المنتجات المتاحة"}),e.jsx(U,{title:"Products",description:"All available products",columns:C,data:m,renderRowActions:n=>e.jsx("div",{className:"flex gap-2",children:e.jsx(d,{onClick:()=>{j(c=>{const a=c.findIndex(o=>o._id===n._id);if(a!==-1){const o=[...c];return o[a].stock+=1,o}return[...c,{_id:n._id,name:n.name,price:n.price,stock:1}]})},size:"sm",children:"أضف إلى الفاتورة"})})})]})})]})}function De(){const p=O().id,[m,g]=l.useState(null),[y,u]=l.useState([]),[j,b]=l.useState(!1),[f,N]=l.useState(!1),[C,w]=l.useState([]),[n,c]=l.useState(!1),[a,o]=l.useState("اضافة دفعة"),[k,V]=l.useState(0),[S,Y]=l.useState(ie()),[D,q]=l.useState(""),[I,_]=l.useState(!1),[J,$]=l.useState(!1),H=l.useRef(null),[G,B]=l.useState([]),K=JSON.parse(localStorage.getItem("DaherUser")),Q=()=>{const s=new Date,i={year:"numeric",month:"numeric",day:"numeric",weekday:"long",hour:"numeric",minute:"numeric",second:"numeric"};return s.toLocaleDateString("en-GB",i)},R=async()=>{try{const s=await v.get(`https://paynet-1.onrender.com/api/invoice/viewBills/${p}`);g(s.data),u(s.data.items),B(s.data.payments||[])}catch(s){console.error(s)}},W=async s=>{var i,r;try{if(!window.confirm("هل انت متاكد من حذف الفاتورة؟"))return;await v.delete(`https://paynet-1.onrender.com/api/invoice/delete-bill-items/${p}/delete-item/${s}`),x.success("تم حذف الفاتورة بنجاح"),u(h=>h.filter(P=>P._id!==s))}catch(t){console.error(t),x.error(((r=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:r.message)||"حدث خطأ أثناء الحذف")}};l.useEffect(()=>{R()},[p]);const X="https://paynet-1.onrender.com",Z=async()=>{var s,i;try{const r=await v.get(`${X}/api/product/get-product`);w(r.data)}catch(r){console.log(r),x.error(((i=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:i.message)||"حدث خطأ أثناء الحذف")}},ee=async s=>{var i,r;s.preventDefault();try{_(!0),await v.post(`https://paynet-1.onrender.com/api/invoice/new-payment/${p}`,{amount:k,date:S,details:D,FormTitle:a}),x.success("تم إضافة الدفعة بنجاح"),c(!1),R()}catch(t){console.log(t),x.error(((r=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:r.message)||"حدث خطأ أثناء إضافة الدفعة")}finally{_(!1)}},se=async s=>{var i,r;try{if(!window.confirm("هل انت متاكد من حذف الدفعة؟"))return;await v.delete(`https://paynet-1.onrender.com/api/invoice/delete-payment/${p}/delete-payment/${s}`),x.success("تم حذف الدفعة بنجاح"),B(h=>h.filter(P=>P._id!==s))}catch(t){console.error(t),x.error(((r=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:r.message)||"حدث خطأ أثناء الحذف")}},te=[{key:"amount",label:"المبلغ"},{key:"details",label:"التفاصيل"},{key:"date",label:"التاريخ"}];return l.useEffect(()=>{Z()},[]),e.jsxs(ae,{children:[e.jsx(le,{isOpen:n,setIsOpen:c,title:a,trigger:e.jsx(e.Fragment,{}),children:e.jsxs("div",{className:"flex flex-row-reverse gap-2",children:[J?e.jsx(e.Fragment,{}):e.jsxs("form",{onSubmit:ee,className:"space-y-4 w-2/3",children:[e.jsx(z,{value:k,onChange:s=>V(Number(s.target.value)),type:"number",placeholder:"القيمة بالدولار",required:!0}),e.jsx(oe,{dateAdapter:de,children:e.jsx(me,{className:"w-full",label:"اختر التاريخ",value:S,onChange:s=>Y(s),format:"DD/MM/YYYY"})}),e.jsx(z,{value:D,onChange:s=>q(s.target.value),type:"text",placeholder:"تفاصيل (اختياري)"}),e.jsx("button",{disabled:!!I,type:"submit",className:"w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition",children:I?"جاري حفظ التعديلات ...":"إرسال"})]}),e.jsxs("div",{ref:H,className:"p-4 text-sm",dir:"rtl",children:[e.jsxs("div",{className:"header",children:[e.jsx("h1",{children:"Daher.Net"}),e.jsx("span",{children:Q()})]}),e.jsxs("div",{className:"text-right font-bold mb-2",children:[e.jsxs("div",{children:["اسم المشترك: ",(m==null?void 0:m.customerName)||"غير معروف"]}),e.jsxs("div",{children:["الرقم: ",(m==null?void 0:m.customerPhone)||"غير معروف"]})]}),e.jsxs("div",{className:"text-right mb-2",children:[e.jsx("div",{className:"font-semibold",children:"التفاصيل:"}),e.jsx("div",{className:"border p-1 rounded",children:D||"بدون ملاحظات"})]}),e.jsx("div",{className:"text-right totalValue mt-4",children:e.jsxs("div",{className:"text-lg font-extrabold border-t pt-2",children:[a=="اضافة دفعة"?"المبلغ المدفوع":"المبلغ المطلوب",": ",k," دولار"]})}),e.jsx("div",{className:"cut mt-4 border-t pt-2 text-center text-xs",children:"-- شكراً لثقتكم بخدماتنا --"})]})]})}),e.jsxs("div",{className:"text-right",dir:"rtl",children:[e.jsxs(A,{children:[e.jsx(F,{children:e.jsx(L,{children:"المعلومات الأساسية"})}),e.jsxs(T,{className:"",children:[e.jsx(ce,{customer:{...m},setCustomer:g}),e.jsxs("div",{className:"flex justify-start gap-2",children:[K.role=="admin"&&e.jsxs(d,{variant:"destructive",onClick:()=>{o("اضافة فاتورة"),$(!1),c(!0)},children:[e.jsx(E,{className:"w-4 h-4 ml-2"})," إضافة فاتورة"]}),e.jsxs(d,{variant:"default",onClick:()=>{o("اضافة دفعة"),$(!1),c(!0)},children:[e.jsx(E,{className:"w-4 h-4 ml-2"})," إضافة دفعة"]}),e.jsx(d,{variant:"outline",children:"واتساب"}),e.jsx(d,{variant:"outline",children:e.jsx(ue,{})})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-6",children:y.map((s,i)=>e.jsxs(A,{children:[e.jsxs(F,{children:[e.jsxs(L,{children:["عنصر رقم ",i+1]}),f?e.jsx(M,{children:e.jsx("input",{type:"text",value:s.name,onChange:r=>u(y.map((t,h)=>h===i?{...t,name:r.target.value}:t))})}):e.jsx(M,{children:s.name})]}),e.jsxs(T,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"السعر:"}),f?e.jsx("input",{type:"number",value:s.price,onChange:r=>u(y.map((t,h)=>h===i?{...t,price:Number(r.target.value)}:t))}):e.jsxs("span",{children:[s.price," $"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"الكمية:"}),f?e.jsx("input",{type:"number",value:s.stock,onChange:r=>u(y.map((t,h)=>h===i?{...t,stock:Number(r.target.value)}:t))}):e.jsx("span",{children:s.stock})]}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"المجموع:"}),e.jsxs("span",{children:[s.price*s.stock," $"]})]})]}),e.jsx(re,{className:"flex justify-end gap-2",children:f?e.jsx(d,{size:"sm",variant:"accent",onClick:()=>N(!1),children:"حفظ التعديلات"}):e.jsx(d,{onClick:()=>W(s._id),size:"sm",variant:"destructive",children:"حذف العنصر"})})]},s._id))}),e.jsxs("div",{className:"mt-4",children:[e.jsx(d,{variant:"secondary",onClick:()=>b(!j),children:j?"إلغاء":"اضافة عنصر جديد"}),j&&e.jsx(pe,{initialItems:y,products:C})]}),e.jsx(U,{className:"my-4",title:"الفواتير",description:"جميع الفواتير المسجلة",columns:te,data:G,getRowClassName:s=>s.FormTitle==="اضافة دفعة"?"text-green-500":"text-red-500",renderRowActions:s=>e.jsx("div",{className:"flex gap-2",children:e.jsx(d,{onClick:()=>se(s._id),variant:"destructive",children:"حذف"})})})]})]})}export{De as default};
