import{r as n,g as S,j as t}from"./index-yz5pP4Y-.js";import{D as P}from"./DataTable-DMxVvtLH.js";import{D as y}from"./DashboardLayout-D3qOJtev.js";import{B as u}from"./button-Cmx31sOJ.js";import{P as D}from"./PopupForm-SW0LB6nP.js";import{I as N}from"./input-Be62XaCd.js";import{c as q,r as I,g as R}from"./invoices-BUZBDLLc.js";import{u as C}from"./useQuery-BB3KChfA.js";import{u as g}from"./useMutation-3Jqre73m.js";import{l as E}from"./index-BLRFddlS.js";import"./card-D4OfAMeV.js";import"./house-CxCSOpgc.js";import"./axios-KE4dpIQc.js";import"./index-xsH4HHeE.js";function J(){const[b,r]=n.useState(!1),[x]=n.useState("سبب الغاء العملية"),[d,m]=n.useState(""),[a,h]=n.useState(null),o=S(),[F,v]=n.useState(null);n.useEffect(()=>{const e=E("https://paynet-cdji.onrender.com");return v(e),e.on("pendingPaymentsUpdate",s=>{o.setQueryData(["pending-table"],s)}),()=>{e.disconnect()}},[o]);const{data:i,isLoading:j}=C({queryKey:["pending-table"],queryFn:R}),l=g({mutationFn:e=>q(e),onSuccess:()=>{o.invalidateQueries({queryKey:["pending-table"]})}}),c=g({mutationFn:e=>I(e),onSuccess:()=>{o.invalidateQueries({queryKey:["pending-table"]})}}),k=[{key:"_id",label:"المعرف",sortable:!0,hidden:!0},{key:"landline",label:"الرقم",sortable:!0},{key:"company",label:"الشركة",sortable:!0},{key:"speed",label:"السرعة",sortable:!0},{key:"email",label:"الحساب المرسل",sortable:!0},{key:"amount",label:"المبلغ الواجب دفعه",sortable:!0},{key:"status",label:"حالة العملية",sortable:!0},{key:"createdAt",label:"الوقت",sortable:!0}];if(j)return t.jsx(y,{children:t.jsx("div",{dir:"rtl",className:"space-y-6 text-center text-lg font-semibold",children:"جارِ تحميل البيانات..."})});n.useEffect(()=>{"Notification"in window&&Notification.requestPermission().then(e=>{console.log("Notification permission:",e)})},[]);const p=n.useRef([]);return n.useEffect(()=>{if(i&&i.length>0){const e=p.current,s=i.filter(f=>!e.some(w=>w._id===f._id));s.length>0&&(new Notification("طلب دفع جديد",{body:`المبلغ: ${s[0].amount} - الشركة: ${s[0].company}`,icon:"/logo.png"}),new Audio("/notification.mp3").play()),p.current=i}},[i]),t.jsxs(y,{children:[t.jsx(D,{isOpen:b,setIsOpen:r,title:x,trigger:t.jsx(t.Fragment,{}),children:t.jsx("div",{className:"flex flex-row-reverse gap-2",children:t.jsxs("form",{onSubmit:e=>{e.preventDefault(),a&&(c.mutate({payment:{id:a._id,email:a.email,amount:a.amount},reason:d}),r(!1),m(""))},className:"space-y-4 w-full",children:[t.jsx(N,{dir:"rtl",value:d,onChange:e=>m(e.target.value),type:"text",placeholder:"سبب الرفض (مثال: لا يوجد رصيد)",required:!0}),t.jsx(u,{type:"submit",children:"تأكيد الرفض"})]})})}),t.jsx("div",{dir:"rtl",className:"space-y-6",children:t.jsx(P,{title:"تسديدات معلقة",description:"",columns:k,data:i||[],renderRowActions:e=>t.jsxs("div",{className:"flex gap-2",children:[t.jsx(u,{variant:"default",size:"sm",onClick:()=>{window.confirm("هل انت متأكد من انهاء العملية")&&l.mutate(e._id)},disabled:l.isPending,children:l.isPending?"...":"تأكيد"}),t.jsx(u,{variant:"destructive",size:"sm",onClick:()=>{h(e),r(!0)},disabled:c.isPending,children:c.isPending?"...":"رفض"})]})})})]})}export{J as default};
