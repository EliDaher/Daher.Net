import{r as d,l as C,j as e,D as B,C as M,m as S,o as v,p as $}from"./index-BBAHsRI9.js";import{C as N}from"./ChartContainer-xRXye8ye.js";import{g as h}from"./balance-zKlc84gq.js";import{a as P}from"./invoices-DSkntHN7.js";import{L as w,A as L,D as T,d as g}from"./DatePicker-CDyV_N7D.js";import{D as Y}from"./DemoContainer-DtAZZkYy.js";function I(){const[f,p]=d.useState([]),[c,b]=d.useState(""),{data:o,isLoading:E}=C({queryKey:["done-table"],queryFn:P,staleTime:1e3*60*1}),x=async()=>{const a=await h("");a!=null&&a.success?p(a.BalanceTable):console.error(a)};function m(a){const s=new Map;return a.forEach(t=>{const n=new Date(t.createdAt),i=n.getFullYear(),l=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),A=`${i}-${l}`,k=`${i}-${l}-${r}`,u=`${t.company}_${A}`;s.has(u)||s.set(u,{sum:0,count:0,days:new Set});const y=s.get(u);y.sum+=t.amount,y.count+=1,y.days.add(k)}),Array.from(s.entries()).filter(([t])=>t.includes(c)).map(([t,n])=>{const[i,l]=t.split("_"),r=n.days.size;return{company:i,date:l,sumAmount:n.sum,avgAmount:r>0?n.sum/r:0,count:n.count,days:r}})}const D=d.useMemo(()=>m(o).reduce((a,s)=>a+Number(s.sumAmount),0),[m(o)]);d.useEffect(()=>{x()},[]);const j=[{key:"company",label:"الشركة",sortable:!0},{key:"date",label:"التاريخ",sortable:!0},{key:"sumAmount",label:"مجموع التسديد",sortable:!0},{key:"count",label:"العدد",sortable:!0},{key:"avgAmount",label:"المتوسط",sortable:!0}];return e.jsx(B,{children:e.jsx("div",{className:"space-y-6",children:e.jsxs(M,{className:"grid gap-6",children:[e.jsxs(S,{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Deep dive into your business metrics and performance insights."}),e.jsx(w,{dateAdapter:L,children:e.jsx(Y,{components:["DatePicker","DatePicker","DatePicker"],children:e.jsx(T,{views:["month","year"],value:g(c),onChange:a=>{const s=a.format("YYYY-MM");b(s),h(s).then(t=>{t!=null&&t.success&&p(t.BalanceTable)})}})})})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(N,{title:c?"تقرير الشهر "+g(c).format("M"):"تقرير الشهر الحالي",data:f||[],type:"stackBar",dataKey:"users"})}),e.jsx("div",{dir:"rtl",children:e.jsx($,{title:"التسديد",description:D.toString(),columns:j,data:o&&!o.error?m(o):[]})})]})]})})})}export{I as default};
