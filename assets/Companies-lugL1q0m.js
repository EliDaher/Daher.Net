import{h as y,j as e,k as C,r as g,l as q,R as F,m as L,n as w}from"./index-BBsww-pv.js";import{P as N}from"./PopupForm-Cj0BuYTK.js";import{B as x}from"./button-C0LLHTIl.js";import{u as S}from"./useMutation-B7GdQpB8.js";import{F as i}from"./FormInput-BlHUKQaV.js";import{u as v}from"./index.esm-CO2naqpE.js";import{D as B}from"./DataTable-D9SE4qrm.js";import{D as I,T as k}from"./DashboardLayout-BUpGslyr.js";import{C as A,a as M,b as P,c as T,d as D}from"./card-C743b22O.js";import{L as O}from"./layout-grid-BD2e68rQ.js";import"./input-F4rUzNKS.js";import"./house-1CJF74NA.js";function E({isOpen:s,setIsOpen:u}){var n,d,a;const c=y(),{register:t,handleSubmit:p,reset:o,formState:{errors:r}}=v({defaultValues:{name:"",initialBalance:0,balanceLimit:0}}),m=S({mutationFn:l=>C(l),onSuccess:()=>{c.invalidateQueries({queryKey:["company-table"]}),o(),u(!1)},onError:()=>{alert("حدث خطأ أثناء الإضافة")}}),j=l=>{m.mutate(l)};return e.jsx(N,{trigger:e.jsx(x,{className:"absolute right-5 bottom-5 z-50",children:"اضافة شركة جديدة"}),isOpen:s,setIsOpen:u,title:"اضافة شركة جديدة",children:e.jsx("form",{onSubmit:p(j),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(i,{id:"companyName",label:"اسم الشركة",...t("name",{required:"اسم الشركة مطلوب"}),error:(n=r.name)==null?void 0:n.message}),e.jsx(i,{id:"initialBalance",label:"الرصيد الافتتاحي",type:"number",...t("initialBalance",{valueAsNumber:!0,required:"الرصيد الافتتاحي مطلوب"}),error:(d=r.initialBalance)==null?void 0:d.message}),e.jsx(i,{id:"balanceLimit",label:"حد الرصيد",type:"number",...t("balanceLimit",{valueAsNumber:!0,required:"حد الرصيد مطلوب"}),error:(a=r.balanceLimit)==null?void 0:a.message}),e.jsx(x,{type:"submit",disabled:m.isPending,children:m.isPending?"جاري الإضافة...":"إضافة"})]})})})}function V({isOpen:s,setIsOpen:u,companyId:c,companyName:t=""}){var h,f;const p=y(),o=g.useMemo(()=>{if(typeof window>"u")return null;const b=localStorage.getItem("DaherUser");return b?JSON.parse(b):null},[]),{register:r,handleSubmit:m,reset:j,setValue:n,formState:{errors:d}}=v({defaultValues:{companyId:"",company:"",number:"",port:(o==null?void 0:o.username)||"",amount:0,paidAmount:0,reason:"",paymentNote:""}});g.useEffect(()=>{c&&(n("companyId",c),n("company",t))},[c,t,n]);const a=S({mutationFn:b=>q(b),onSuccess:()=>{p.invalidateQueries({queryKey:["company-table"]}),j(),u(!1)},onError:()=>{alert("حدث خطأ أثناء زيادة الرصيد")}}),l=b=>{a.mutate(b)};return e.jsx(N,{trigger:e.jsx(e.Fragment,{children:e.jsx(x,{variant:"outline",children:"زيادة رصيد شركة"})}),isOpen:s,setIsOpen:u,title:"زيادة رصيد شركة",children:e.jsx("form",{onSubmit:m(l),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(i,{label:"معرف الشركة",...r("companyId",{required:"معرف الشركة مطلوب"}),error:(h=d.companyId)==null?void 0:h.message,disabled:!0}),e.jsx(i,{label:"اسم الشركة",...r("company"),disabled:!0}),e.jsx(i,{label:"رقم الاشعار اذا وجد",...r("number")}),e.jsx(i,{label:"المنفذ",...r("port"),disabled:!0}),e.jsx(i,{label:"قيمة الزيادة",type:"number",...r("amount",{valueAsNumber:!0,required:"قيمة الزيادة مطلوبة"}),error:(f=d.amount)==null?void 0:f.message}),e.jsx(i,{label:"المبلغ المدفوع",type:"number",...r("paidAmount",{valueAsNumber:!0})}),e.jsx(i,{label:"ملاحظة الدفع",...r("reason")}),e.jsx(x,{type:"submit",disabled:a.isPending,children:a.isPending?"جاري الحفظ...":"حفظ"})]})})})}function Q({isOpen:s,setIsOpen:u,companyId:c,companyName:t}){var l,h;const p=y(),o=F.useMemo(()=>{try{return JSON.parse(localStorage.getItem("DaherUser")||"{}")}catch{return{}}},[]),{register:r,handleSubmit:m,reset:j,formState:{errors:n}}=v({defaultValues:{reason:"",amount:0}}),d=S({mutationFn:f=>{const b={amount:f.amount,reason:f.reason||"تحويل رصيد",company:t,number:56315,companyId:c,port:(o==null?void 0:o.username)||""};return L(b)},onSuccess:()=>{p.invalidateQueries({queryKey:["company-table"]}),j(),u(!1)},onError:()=>{alert("حدث خطأ أثناء تحويل الرصيد")}}),a=f=>{d.mutate(f)};return e.jsx(N,{title:`تحويل رصيد ${t}`,trigger:e.jsx(x,{children:"تحويل رصيد"}),isOpen:s,setIsOpen:u,children:e.jsxs("form",{onSubmit:m(a),className:"space-y-4",children:[e.jsx(i,{id:"amount",label:"المبلغ",type:"number",...r("amount",{valueAsNumber:!0,required:"المبلغ مطلوب",min:{value:1,message:"يجب أن يكون أكبر من صفر"}}),error:(l=n.amount)==null?void 0:l.message}),e.jsx(i,{id:"reason",label:"ملاحظات + الوجهة",type:"text",...r("reason",{required:"مطلوب"}),error:(h=n.reason)==null?void 0:h.message}),e.jsx(x,{type:"submit",disabled:d.isPending,className:"w-full",children:d.isPending?"جارٍ التحويل...":"تأكيد التحويل"})]})})}function _(){const{data:s,isLoading:u}=w(),[c,t]=g.useState(null),[p,o]=g.useState(!1),[r,m]=g.useState("cards"),[j,n]=g.useState(null),d=[{key:"name",label:"الشركة",sortable:!0},{key:"balance",label:"الرصيد",sortable:!0},{key:"balanceLimit",label:"الحد الادنى للرصيد",sortable:!0},{key:"lastUpdate",label:"اخر عملية",sortable:!0}];return e.jsx(I,{children:e.jsxs("div",{dir:"rtl",children:[e.jsx(E,{isOpen:p,setIsOpen:o}),e.jsxs("div",{className:"mb-10 flex flex-col items-center md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-4xl font-bold tracking-tight",children:"الشركات"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{variant:r==="cards"?"default":"outline",onClick:()=>m("cards"),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"عرض كبطاقات"]}),e.jsxs(x,{variant:r==="table"?"default":"outline",onClick:()=>m("table"),children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"عرض كجدول"]})]})]}),e.jsx("div",{dir:"rtl",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:!u&&r==="cards"?s?s==null?void 0:s.map(a=>e.jsxs(A,{dir:"rtl",className:`
                  hover:shadow-lg
                  transition-shadow
                  duration-300
                  ${a.balance<a.balanceLimit?"border-destructive border-2":"border-accent-500 border-2"}  
                `,children:[e.jsx(M,{children:e.jsx(P,{children:e.jsx("h3",{className:"text-xl font-bold mb-2",children:a.name})})}),e.jsxs(T,{children:[e.jsxs("p",{children:["الرصيد: ",a.balance]}),e.jsxs("p",{children:["الحد الادنى للرصيد: ",a.balanceLimit]}),e.jsxs("p",{children:["اخر عملية:"," ",new Date(a.lastUpdate).toLocaleString("en-GB")]})]}),e.jsxs(D,{className:"grid gap-2",children:[e.jsx(V,{companyId:a.id,companyName:a.name,isOpen:j===a.id,setIsOpen:l=>{n(l?a.id:null)}}),["برونت","هاي فاي"].includes(a.name)&&e.jsx(e.Fragment,{children:e.jsx(Q,{companyId:a.id,companyName:a.name,isOpen:c===a.id,setIsOpen:l=>{t(l?a.id:null)}})})]})]},a.id)):[]:e.jsx(B,{className:"col-span-3",title:"",data:s||[],columns:d,getRowClassName:a=>a.balance<a.balanceLimit?"bg-red-100 dark:bg-red-900":"bg-accent-900 dark:bg-accent-100"})})]})})}export{_ as default};
