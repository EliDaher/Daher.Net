import{r as a,i as M,j as e,o as O}from"./index-DjtrOvVI.js";import{D as x}from"./DashboardLayout-BHIEqfHp.js";import{D as P}from"./DataTable-BcblhkSS.js";import{P as q,a as B,b as V,C as z}from"./popover-B2Ng-1ld.js";import{B as I}from"./button-BK6lVoHu.js";import{C as $,a as A,c as F}from"./card-CLiHiovH.js";import{S as f,a as p,b as j,c as b,d as l}from"./select-_uiUeovW.js";import"./house-C1D2S_pc.js";import"./input-DK-39AZO.js";import"./index-D221OsCf.js";import"./index-BMhVl2ff.js";function ee(){const[s,C]=a.useState(void 0),[n,g]=a.useState("all"),[i,w]=a.useState("all"),[c,D]=a.useState("all"),[h,H]=a.useState(""),u=s!=null&&s.from?new Date(s.from.getTime()+Math.abs(s.from.getTimezoneOffset()*6e4)).toISOString().split("T")[0]:"",d=s!=null&&s.to?new Date(s.to.getTime()+Math.abs(s.to.getTimezoneOffset()*6e4)).toISOString().split("T")[0]:"",{data:o=[],isLoading:N,isError:T}=M({queryKey:["done-invoices",u,d],queryFn:()=>O({fromDate:u,toDate:d}),enabled:!!u&&!!d}),m=a.useMemo(()=>o.filter(t=>n==="all"?!0:t.company===n).filter(t=>c==="all"?!0:t.status===c).filter(t=>i==="all"?!0:t.email===i).filter(t=>{var y,S,v;if(!h)return!0;const r=h.toLowerCase();return((y=t.landline)==null?void 0:y.toLowerCase().includes(r))||((S=t.email)==null?void 0:S.toLowerCase().includes(r))||((v=t.note)==null?void 0:v.toLowerCase().includes(r))}),[o,n,i,c,h]),k=[{key:"id",label:"المعرف",sortable:!0,hidden:!0},{key:"number",label:"الرقم",sortable:!0},{key:"company",label:"الشركة",sortable:!0},{key:"amount",label:"المبلغ المسدد",sortable:!0},{key:"beforeBalance",label:"الرصيد قبل العملية",sortable:!0},{key:"afterBalance",label:"الرصيد بعد العملية",sortable:!0},{key:"date",label:"تاريخ العملية",sortable:!0},{key:"port",label:"المنفذ",sortable:!0},{key:"reason",label:"ملاحظات",sortable:!0},{key:"type",label:"النوع",sortable:!0}],L=a.useMemo(()=>{const t=new Set;return o.forEach(r=>{r.company&&t.add(r.company)}),Array.from(t)},[o]),E=a.useMemo(()=>{const t=new Set;return o.forEach(r=>{r.email&&t.add(r.email)}),Array.from(t)},[o]);return a.useMemo(()=>m.reduce((t,r)=>(r.amount&&(t+=r.amount),t),0),[m]),N?e.jsx(x,{children:e.jsx("div",{dir:"rtl",className:"flex h-[70vh] items-center justify-center text-lg font-semibold",children:"جارِ تحميل البيانات..."})}):T?e.jsx(x,{children:e.jsx("div",{dir:"rtl",className:"flex h-[70vh] items-center justify-center text-red-600 text-lg font-semibold",children:"حدث خطأ أثناء تحميل البيانات"})}):e.jsx(x,{children:e.jsxs("div",{dir:"rtl",className:"space-y-6",children:[e.jsxs($,{className:"p-2 space-y-4",children:[e.jsx(A,{className:"text-3xl font-semibold",children:"الفلاتر"}),e.jsxs(F,{className:"flex flex-wrap gap-4",children:[e.jsxs(f,{value:n,onValueChange:g,children:[e.jsx(p,{className:"w-40",children:e.jsx(j,{placeholder:"الشركة"})}),e.jsxs(b,{children:[e.jsx(l,{value:"all",children:"الكل"}),L.map(t=>e.jsx(l,{value:t,children:t},t))]})]}),e.jsxs(f,{value:i,onValueChange:w,children:[e.jsx(p,{className:"w-40",children:e.jsx(j,{placeholder:"الشركة"})}),e.jsxs(b,{children:[e.jsx(l,{value:"all",children:"الكل"}),E.map(t=>e.jsx(l,{value:t,children:t},t))]})]}),e.jsxs(f,{value:c,onValueChange:D,children:[e.jsx(p,{className:"w-40",children:e.jsx(j,{placeholder:"الحالة"})}),e.jsxs(b,{children:[e.jsx(l,{value:"all",children:"الكل"}),e.jsx(l,{value:"تم التسديد",children:"تم التسديد"}),e.jsx(l,{value:"غير مسددة",children:"غير مسددة"}),e.jsx(l,{value:"مرفوضة",children:"مرفوضة"})]})]}),e.jsxs(q,{children:[e.jsx(B,{asChild:!0,children:e.jsx(I,{variant:"outline",className:"whitespace-nowrap",children:s!=null&&s.from&&(s!=null&&s.to)?`من ${u} إلى ${d}`:"اختر المدة الزمنية"})}),e.jsx(V,{className:"w-auto p-0",align:"start",children:e.jsx(z,{initialFocus:!0,mode:"range",selected:s,onSelect:C,numberOfMonths:2})})]})]})]}),e.jsx(P,{title:"المبالغ المسددة للشركات",columns:k,data:m,description:`عدد العمليات ${m.length}`,totalPend:!0,pageSizeOptions:[10,20,50,100,200]})]})})}export{ee as default};
