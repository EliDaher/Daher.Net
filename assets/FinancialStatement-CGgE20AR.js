import{r as h,v as f,j as e,D as v,C as p,m as u,n as j,o as N,B as C}from"./index-CrMoN2Dt.js";import{F as D}from"./FormInput-CVh-hAfm.js";import{f as S}from"./invoices-BHMPl9B-.js";import{R as w,T as F,C as R}from"./index-BQgUcm0o.js";function k(){const[t,b]=h.useState(""),[n,c]=h.useState([]),a=f({mutationFn:async()=>{if(!t.trim()){alert("الرجاء إدخال كلمة للبحث");return}return await S(t)},onSuccess:s=>{!s||s.message?(c([]),alert("لا توجد نتائج مطابقة")):(console.log("Search Results:",s),c(s))},onError:s=>{console.error(s),alert("حدث خطأ أثناء تنفيذ البحث")}}),g=()=>{a.mutate()};return e.jsx(v,{children:e.jsxs("div",{dir:"rtl",className:"p-4 space-y-4",children:[e.jsxs(p,{children:[e.jsx(u,{children:e.jsx(j,{children:"البحث في الفواتير (البيان المالي)"})}),e.jsx(N,{className:"space-y-3",children:e.jsxs("form",{className:"flex",onSubmit:s=>{s.preventDefault(),g()},children:[e.jsx(D,{label:"",id:"BillSearch",type:"text",value:t,onChange:s=>b(s.target.value),placeholder:"أدخل اسم الزبون أو رقم الفاتورة",className:"w-full rounded-l-none"}),e.jsx(C,{type:"submit",disabled:a.isPending,className:"mt-1 rounded-r-none",children:a.isPending?"جاري البحث...":"بحث"})]})})]}),n.length>0&&e.jsxs(p,{children:[e.jsx(u,{children:e.jsx(j,{children:"نتائج البحث"})}),e.jsx(N,{children:e.jsx("div",{className:"bg-background rounded-xl shadow-md overflow-x-auto",children:a.isPending?e.jsx("div",{className:"p-6 text-center text-foreground",children:"جاري التحميل..."}):e.jsxs("table",{className:"min-w-full text-sm text-foreground",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-foreground/20 text-foreground text-right",children:[e.jsx("th",{className:"py-3 px-4",children:"#"}),e.jsx("th",{className:"py-3 px-4",children:"الموظف"}),e.jsx("th",{className:"py-3 px-4",children:"التفاصيل"}),e.jsx("th",{className:"py-3 px-4",children:"المبلغ"}),e.jsx("th",{className:"py-3 px-4",children:"التاريخ"})]})}),e.jsx("tbody",{children:n.map((s,d)=>{var o,i,x,m;const l=(o=s.invoiceData)!=null&&o.details?Object.values(s.invoiceData.details):[];return e.jsxs("tr",{className:"border-b hover:bg-foreground/20 transition",children:[e.jsx("td",{className:"py-3 px-4",children:d+1}),e.jsx("td",{className:"py-3 px-4 font-medium",children:s.employee}),e.jsx("td",{className:"py-3 px-4",children:l.length>0?e.jsxs(w,{children:[e.jsx(F,{asChild:!0,children:e.jsx("button",{className:"text-accent hover:underline",children:l.map(r=>r.customerName+"//"+r.invoiceNumber+"//"+r.customerDetails).join(", ")})}),e.jsx(R,{side:"bottom",align:"start",className:"bg-background border border-gray-200 rounded-lg shadow-lg p-4 max-w-lg",children:e.jsxs("table",{className:"text-sm w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-foreground/30 text-foreground",children:[e.jsx("th",{className:"border px-2 py-1",children:"العميل"}),e.jsx("th",{className:"border px-2 py-1",children:"الرقم"}),e.jsx("th",{className:"border px-2 py-1",children:"رقم الفاتورة"}),e.jsx("th",{className:"border px-2 py-1",children:"القيمة"}),e.jsx("th",{className:"border px-2 py-1",children:"الملاحظات"})]})}),e.jsx("tbody",{children:l.map((r,y)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:r.customerName}),e.jsx("td",{className:"border px-2 py-1",children:r.customerNumber}),e.jsx("td",{className:"border px-2 py-1",children:r.invoiceNumber}),e.jsx("td",{className:"border px-2 py-1",children:r.invoiceValue}),e.jsx("td",{className:"border px-2 py-1",children:r.customerDetails})]},y))})]})})]}):e.jsx("span",{className:"text-gray-400",children:"لا تفاصيل"})}),e.jsx("td",{className:"py-3 px-4 text-blue-600 font-semibold",children:(x=(i=s.invoiceData)==null?void 0:i.amount)==null?void 0:x.toLocaleString("en-EG",{minimumFractionDigits:0})}),e.jsx("td",{className:"py-3 px-4",children:((m=s.invoiceData)==null?void 0:m.timestamp)||s.date})]},d)})})]})})})]})]})})}export{k as default};
