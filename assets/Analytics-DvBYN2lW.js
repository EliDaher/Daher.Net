import{r as l,f as C,j as e}from"./index-DeUUlL9l.js";import{C as B}from"./ChartContainer-CLdluTNf.js";import{D as M}from"./DataTable-BqyNnvuC.js";import{D as S}from"./DashboardLayout-BPlQhhSI.js";import{C as v,a as $,c as N}from"./card-B7FlCwkI.js";import{g as f}from"./balance-BthrWZY_.js";import{a as P}from"./invoices-DO2Js6zg.js";import{L as w,A as L,D as T,d as h}from"./DatePicker-BAQgg1Xq.js";import{D as Y}from"./DemoContainer-BDYFW1Pa.js";import"./button-BbuLOj8Q.js";import"./input-BSkmp32h.js";import"./house-tY2-Z_zD.js";function U(){const[g,p]=l.useState([]),[c,D]=l.useState(""),{data:o,isLoading:E}=C({queryKey:["done-table"],queryFn:P,staleTime:1e3*60*1}),b=async()=>{const t=await f("");t!=null&&t.success?p(t.BalanceTable):console.error(t)};function d(t){const s=new Map;return t==null||t.forEach(a=>{const n=new Date(a.createdAt),i=n.getFullYear(),m=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),A=`${i}-${m}`,k=`${i}-${m}-${r}`,u=`${a.company}_${A}`;s.has(u)||s.set(u,{sum:0,count:0,days:new Set});const y=s.get(u);y.sum+=a.amount,y.count+=1,y.days.add(k)}),Array.from(s.entries()).filter(([a])=>a.includes(c)).map(([a,n])=>{const[i,m]=a.split("_"),r=n.days.size;return{company:i,date:m,sumAmount:n.sum,avgAmount:r>0?n.sum/r:0,count:n.count,days:r}})}const x=l.useMemo(()=>d(o).reduce((t,s)=>t+Number(s.sumAmount),0),[d(o)]);l.useEffect(()=>{b()},[]);const j=[{key:"company",label:"الشركة",sortable:!0},{key:"date",label:"التاريخ",sortable:!0},{key:"sumAmount",label:"مجموع التسديد",sortable:!0},{key:"count",label:"العدد",sortable:!0},{key:"avgAmount",label:"المتوسط",sortable:!0}];return e.jsx(S,{children:e.jsx("div",{className:"space-y-6",children:e.jsxs(v,{className:"grid gap-6",children:[e.jsxs($,{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Deep dive into your business metrics and performance insights."}),e.jsx(w,{dateAdapter:L,children:e.jsx(Y,{components:["DatePicker","DatePicker","DatePicker"],children:e.jsx(T,{views:["month","year"],value:h(c),onChange:t=>{const s=t.format("YYYY-MM");D(s),f(s).then(a=>{a!=null&&a.success&&p(a.BalanceTable)})}})})})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(B,{title:c?"تقرير الشهر "+h(c).format("M"):"تقرير الشهر الحالي",data:g||[],type:"stackBar",dataKey:"users"})}),e.jsx("div",{dir:"rtl",children:e.jsx(M,{title:"التسديد",description:x.toString(),columns:j,data:o&&!o.error?d(o):[]})})]})]})})})}export{U as default};
