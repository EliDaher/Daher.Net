import{c as L,r as n,u as ie,j as e,a as ce,P as C,b as S,d as le,e as D,f as de,g as ue}from"./index-BgZ0y2RS.js";import{u as me}from"./useQuery-DmOQajqN.js";import{u as pe,a as fe,c as $,R as ge,I as xe,D as ve,U as be}from"./DashboardLayout-BTJlAQGA.js";import{S as w}from"./StatsCard-DqnjNiqA.js";import{C as h}from"./ChartContainer-Bj-9Cu7x.js";import{C as I,a as P,b as B,c as E}from"./card-BJI70kzF.js";import{g as he}from"./wifi-LQWNa4dc.js";import{g as _,a as ye}from"./balance-DwEg57Mm.js";import{L as je,A as Ne,D as Ce,d as Te}from"./DatePicker-CmygnVc0.js";import{g as Se}from"./invoices-BUZBDLLc.js";import{l as we}from"./index-BLRFddlS.js";import{C as F}from"./credit-card-CUbw5u6n.js";import{D as De}from"./DemoContainer-DXycdpZM.js";import"./button-CjsE_30j.js";import"./house-CRhvWgmf.js";import"./axios-KE4dpIQc.js";import"./index-xsH4HHeE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=L("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=L("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);var k="Tabs",[Me,Ze]=ce(k,[$]),K=$(),[Ae,R]=Me(k),V=n.forwardRef((a,r)=>{const{__scopeTabs:c,value:d,onValueChange:o,defaultValue:p,orientation:i="horizontal",dir:f,activationMode:x="automatic",...g}=a,m=pe(f),[u,v]=ie({prop:d,onChange:o,defaultProp:p});return e.jsx(Ae,{scope:c,baseId:fe(),value:u,onValueChange:v,orientation:i,dir:m,activationMode:x,children:e.jsx(C.div,{dir:m,"data-orientation":i,...g,ref:r})})});V.displayName=k;var q="TabsList",G=n.forwardRef((a,r)=>{const{__scopeTabs:c,loop:d=!0,...o}=a,p=R(q,c),i=K(c);return e.jsx(ge,{asChild:!0,...i,orientation:p.orientation,dir:p.dir,loop:d,children:e.jsx(C.div,{role:"tablist","aria-orientation":p.orientation,...o,ref:r})})});G.displayName=q;var U="TabsTrigger",H=n.forwardRef((a,r)=>{const{__scopeTabs:c,value:d,disabled:o=!1,...p}=a,i=R(U,c),f=K(c),x=Y(i.baseId,d),g=Q(i.baseId,d),m=d===i.value;return e.jsx(xe,{asChild:!0,...f,focusable:!o,active:m,children:e.jsx(C.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":g,"data-state":m?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:x,...p,ref:r,onMouseDown:S(a.onMouseDown,u=>{!o&&u.button===0&&u.ctrlKey===!1?i.onValueChange(d):u.preventDefault()}),onKeyDown:S(a.onKeyDown,u=>{[" ","Enter"].includes(u.key)&&i.onValueChange(d)}),onFocus:S(a.onFocus,()=>{const u=i.activationMode!=="manual";!m&&!o&&u&&i.onValueChange(d)})})})});H.displayName=U;var z="TabsContent",O=n.forwardRef((a,r)=>{const{__scopeTabs:c,value:d,forceMount:o,children:p,...i}=a,f=R(z,c),x=Y(f.baseId,d),g=Q(f.baseId,d),m=d===f.value,u=n.useRef(m);return n.useEffect(()=>{const v=requestAnimationFrame(()=>u.current=!1);return()=>cancelAnimationFrame(v)},[]),e.jsx(le,{present:o||m,children:({present:v})=>e.jsx(C.div,{"data-state":m?"active":"inactive","data-orientation":f.orientation,role:"tabpanel","aria-labelledby":x,hidden:!v,id:g,tabIndex:0,...i,ref:r,style:{...a.style,animationDuration:u.current?"0s":void 0},children:v&&p})})});O.displayName=z;function Y(a,r){return`${a}-trigger-${r}`}function Q(a,r){return`${a}-content-${r}`}var Ie=V,W=G,J=H,Z=O;const Pe=Ie,X=n.forwardRef(({className:a,...r},c)=>e.jsx(W,{ref:c,className:D("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r}));X.displayName=W.displayName;const j=n.forwardRef(({className:a,...r},c)=>e.jsx(J,{ref:c,className:D("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...r}));j.displayName=J.displayName;const N=n.forwardRef(({className:a,...r},c)=>e.jsx(Z,{ref:c,className:D("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r}));N.displayName=Z.displayName;function Xe(){const a=de(),r=JSON.parse(localStorage.getItem("DaherUser")),[c,d]=n.useState(0),[o,p]=n.useState([]),[i,f]=n.useState([]),[x,g]=n.useState([]),[m,u]=n.useState(""),[v,ee]=n.useState(null),M=ue(),{data:b,isLoading:Be}=me({queryKey:["pending-table"],queryFn:Se});n.useEffect(()=>{"Notification"in window&&Notification.requestPermission().then(t=>{console.log("Notification permission:",t)})},[]);const A=n.useRef([]);n.useEffect(()=>{if(b&&b.length>0){const t=A.current,s=b.filter(l=>!t.some(y=>y._id===l._id));s.length>0&&(new Notification("طلب دفع جديد",{body:`المبلغ: ${s[0].amount} - الشركة: ${s[0].company}`,icon:"/logo.png"}),new Audio("/notification.mp3").play()),A.current=b}},[b]),n.useEffect(()=>{const t=we("https://paynet-cdji.onrender.com");return ee(t),t.on("pendingPaymentsUpdate",s=>{M.setQueryData(["pending-table"],s)}),()=>{t.disconnect()}},[M]);const te=async()=>{const t=await _("");t!=null&&t.success?g(t.BalanceTable):console.error(t)},ae=async()=>{const t=await he();t!=null&&t.success?r.role=="dealer"?p(t.customers.filter(s=>s.dealer==="habeb")):p(t.customers):alert((t==null?void 0:t.error)||"فشل جلب البيانات")},se=async()=>{const t=await ye("");t!=null&&t.success?f(t.BalanceTable):console.log((t==null?void 0:t.error)||"فشل جلب البيانات"),console.log(t)};n.useEffect(()=>{ae(),se(),te()},[]);const ne=n.useMemo(()=>o.reduce((t,s)=>t+Number(s.SubscriptionSpeed),0),[o]),oe=n.useMemo(()=>{const t=o.filter(s=>s.Balance<0).reduce((s,l)=>s+Number(l.Balance),0);return Math.abs(t)},[o]);return n.useEffect(()=>{let t=0;i.forEach(s=>{t+=s.total}),d(t)},[i]),e.jsx(ve,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Welcome back! Here's what's happening with your business today."})]}),e.jsxs("div",{dir:"rtl",className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(w,{onClick:()=>{a("/users")},title:"عدد مشتركين الفضائي",value:o.length||0,icon:be}),e.jsx(w,{onClick:()=>{a("/users",{state:"unpaid"})},title:"ديون الفضائي",value:oe||0,icon:F}),e.jsx(w,{onClick:()=>{a("/PendingTransactions")},title:"الفواتير الغير مدفوعة",value:b?b.length:0,icon:Re})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 text-center",children:[e.jsx(h,{className:"mdL:col-span-2",title:" توزع المرسلات ",data:o.reduce((t,s)=>{const l=(s.sender??"").trim(),y=Number(s.SubscriptionSpeed),T=t.find(re=>re.sender===l);return T?(T.totalSpeed+=y,T.customerCount+=1):t.push({sender:l,totalSpeed:y,customerCount:1}),t},[]),type:"bar",dataKey2:"customerCount",dataKey:"totalSpeed"}),r.role!="admin"?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsx(h,{title:"صناديق اليوم",data:i,type:"line",dataKey2:"count",desc:c.toString(),dataKey:"total"})}),e.jsx(h,{title:"عدد المشتركين حسب السرعة",type:"pie",dataKey:"value",data:Object.values(o.reduce((t,s)=>{const l=s.SubscriptionSpeed||"غير محددة";return t[l]||(t[l]={name:`${l} Mbps`,value:0}),t[l].value+=1,t},{})),desc:ne.toString()+" Mbps"})]}),r.role!="admin"?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsxs(Pe,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(X,{children:[e.jsx(j,{value:"overview",children:"Overview"}),e.jsx(j,{value:"analytics",children:"Analytics"}),e.jsx(j,{value:"reports",children:"Reports"})]}),e.jsx(N,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs(I,{children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Active Users"}),e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"2,350"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+180.1% from last month"})]})]}),e.jsxs(I,{children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"$45,231.89"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+20.1% from last month"})]})]}),e.jsx(h,{title:"Revenue Distribution",data:(o==null?void 0:o.slice(0,4))||[],type:"pie",dataKey:"revenue"})]})}),e.jsx(N,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{className:"bg-background/80 text-foreground",children:e.jsx(je,{dateAdapter:Ne,children:e.jsx(De,{components:["DatePicker","DatePicker","DatePicker"],children:e.jsx(Ce,{views:["month","year"],value:Te(m),onChange:t=>{const s=t.format("YYYY-MM");u(s),_(s).then(l=>{l!=null&&l.success&&g(l.BalanceTable)})}})})})}),e.jsx(h,{title:"صناديق الشهر الحالي",data:x||[],type:"stackBar",dataKey:"users"})]})}),e.jsx(N,{value:"reports",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Reports Coming Soon"}),e.jsx("p",{className:"text-muted-foreground",children:"Advanced reporting features will be available soon."})]})})]})})]})})}export{Xe as default};
