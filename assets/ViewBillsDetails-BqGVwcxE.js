import{r as h,j as e,B as n,K as I,D as P,C as g,m as y,n as C,o as N,aj as k,ak as B,p as z,J as w}from"./index-CV6KU4Cz.js";import{D as $,R}from"./DetailsInputs-CbPQyykQ.js";import{P as D}from"./plus-BjdBaap5.js";import"./wifi-WdB1kLwB.js";function U({initialItems:j=[]}){const[f,v]=h.useState(!0),[r,i]=h.useState(j),o=(t,c,l)=>{const s=[...r];s[t]={...s[t],[c]:l},i(s)},b=()=>{i([...r,{name:"",price:0,stock:1}])},m=t=>{i(r.filter((c,l)=>l!==t))},x=t=>{t.preventDefault(),console.log("Items to submit:",r),v(!1)};return e.jsx("div",{children:f&&e.jsxs("form",{onSubmit:x,className:"mt-4 space-y-4 p-4 border rounded",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"ادخل بيانات العناصر"}),r.map((t,c)=>e.jsxs("div",{className:"grid grid-cols-4 gap-2 items-center border-b py-2",children:[e.jsx("input",{type:"text",placeholder:"اسم المنتج",value:t.name,onChange:l=>o(c,"name",l.target.value),className:"border p-1 rounded col-span-1"}),e.jsx("input",{type:"number",placeholder:"السعر",value:t.price,onChange:l=>o(c,"price",Number(l.target.value)),className:"border p-1 rounded col-span-1"}),e.jsx("input",{type:"number",placeholder:"الكمية",value:t.stock,onChange:l=>o(c,"stock",Number(l.target.value)),className:"border p-1 rounded col-span-1"}),e.jsx(n,{type:"button",variant:"destructive",size:"sm",onClick:()=>m(c),children:"حذف"})]},c)),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx(n,{type:"button",onClick:b,children:"إضافة عنصر جديد"}),e.jsx(n,{type:"submit",variant:"accent",children:"حفظ العناصر"})]})]})})}function J(){const j=I().id,[f,v]=h.useState(null),[r,i]=h.useState([]),[o,b]=h.useState(!1),[m,x]=h.useState(!1),t=JSON.parse(localStorage.getItem("DaherUser")),c=async()=>{try{const s=await w.get(`https://paynet-1.onrender.com/api/invoice/viewBills/${j}`);v(s.data),i(s.data.items)}catch(s){console.error(s)}},l=async s=>{var u,d;try{if(!window.confirm("هل انت متاكد من حذف الفاتورة؟"))return;await w.delete(`https://paynet-1.onrender.com/api/invoice/delete-bill-items/${j}/delete-item/${s}`),alert("تم حذف الفاتورة بنجاح"),i(p=>p.filter(S=>S._id!==s))}catch(a){console.error(a),alert(((d=(u=a==null?void 0:a.response)==null?void 0:u.data)==null?void 0:d.message)||"حدث خطأ أثناء الحذف")}};return h.useEffect(()=>{c()},[j]),e.jsx(P,{children:e.jsxs("div",{className:"text-right",dir:"rtl",children:[e.jsxs(g,{children:[e.jsx(y,{children:e.jsx(C,{children:"المعلومات الأساسية"})}),e.jsxs(N,{className:"",children:[e.jsx($,{customer:{...f},setCustomer:v}),e.jsxs("div",{className:"flex justify-start gap-2",children:[t.role=="admin"&&e.jsxs(n,{variant:"destructive",children:[e.jsx(D,{className:"w-4 h-4 ml-2"})," إضافة فاتورة"]}),e.jsxs(n,{variant:"default",onClick:()=>{},children:[e.jsx(D,{className:"w-4 h-4 ml-2"})," إضافة دفعة"]}),e.jsx(n,{variant:"outline",children:"واتساب"}),e.jsx(n,{variant:"outline",children:e.jsx(R,{})})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-6",children:r.map((s,u)=>e.jsxs(g,{children:[e.jsxs(y,{children:[e.jsxs(C,{children:["عنصر رقم ",u+1]}),m?e.jsx(k,{children:e.jsx("input",{type:"text",value:s.name,onChange:d=>i(r.map((a,p)=>p===u?{...a,name:d.target.value}:a))})}):e.jsx(k,{children:s.name})]}),e.jsxs(N,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"السعر:"}),m?e.jsx("input",{type:"number",value:s.price,onChange:d=>i(r.map((a,p)=>p===u?{...a,price:Number(d.target.value)}:a))}):e.jsxs("span",{children:[s.price," $"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"الكمية:"}),m?e.jsx("input",{type:"number",value:s.stock,onChange:d=>i(r.map((a,p)=>p===u?{...a,stock:Number(d.target.value)}:a))}):e.jsx("span",{children:s.stock})]}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"المجموع:"}),e.jsxs("span",{children:[s.price*s.stock," $"]})]})]}),e.jsxs(B,{className:"flex justify-end gap-2",children:[m?e.jsx(n,{size:"sm",variant:"accent",onClick:()=>x(!1),children:"حفظ التعديلات"}):e.jsx(n,{size:"sm",variant:"default",onClick:()=>x(!0),children:"   تعديل العنصر"}),m?e.jsx(n,{size:"sm",variant:"destructive",onClick:()=>x(!1),children:"   الغاء التعديل"}):e.jsx(n,{onClick:()=>l(s._id),size:"sm",variant:"destructive",children:"حذف العنصر"})]})]},s._id))}),e.jsxs("div",{className:"mt-4",children:[e.jsx(n,{variant:"secondary",onClick:()=>b(!o),children:o?"إلغاء":"اضافة عنصر جديد"}),o&&e.jsx(U,{initialItems:r})]}),e.jsx(z,{className:"my-4",title:"الفواتير",description:"جميع الفواتير المسجلة",columns:[],data:[]})]})})}export{J as default};
