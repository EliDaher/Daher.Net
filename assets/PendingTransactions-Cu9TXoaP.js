import{r as s,g as h,j as e}from"./index-BDEvpPy0.js";import{D as k}from"./DataTable-BgnFipeW.js";import{D as c}from"./DashboardLayout-CI8m_gX9.js";import{B as l}from"./button-BLetExgu.js";import{P as S}from"./PopupForm-Bx2U8o2j.js";import{I as P}from"./input-CK_vWQXP.js";import{c as w,r as D,g as q}from"./invoices-BUZBDLLc.js";import{u as C}from"./useQuery-D7kiyVYs.js";import{u as m}from"./useMutation-BsDSHpaZ.js";import{l as I}from"./index-BLRFddlS.js";import"./card-en6WJuJj.js";import"./house-B8Ikywws.js";import"./axios-KE4dpIQc.js";import"./index-xsH4HHeE.js";function G(){const[p,r]=s.useState(!1),[f]=s.useState("سبب الغاء العملية"),[u,d]=s.useState(""),[n,y]=s.useState(null),a=h(),[F,b]=s.useState(null);s.useEffect(()=>{const t=I("https://paynet-cdji.onrender.com");return b(t),t.on("pendingPaymentsUpdate",v=>{a.setQueryData(["pending-table"],v)}),()=>{t.disconnect()}},[a]);const{data:g,isLoading:x}=C({queryKey:["pending-table"],queryFn:q}),i=m({mutationFn:t=>w(t),onSuccess:()=>{a.invalidateQueries({queryKey:["pending-table"]})}}),o=m({mutationFn:t=>D(t),onSuccess:()=>{a.invalidateQueries({queryKey:["pending-table"]})}}),j=[{key:"_id",label:"المعرف",sortable:!0,hidden:!0},{key:"landline",label:"الرقم",sortable:!0},{key:"company",label:"الشركة",sortable:!0},{key:"speed",label:"السرعة",sortable:!0},{key:"email",label:"الحساب المرسل",sortable:!0},{key:"amount",label:"المبلغ الواجب دفعه",sortable:!0},{key:"status",label:"حالة العملية",sortable:!0},{key:"createdAt",label:"الوقت",sortable:!0}];return x?e.jsx(c,{children:e.jsx("div",{dir:"rtl",className:"space-y-6 text-center text-lg font-semibold",children:"جارِ تحميل البيانات..."})}):e.jsxs(c,{children:[e.jsx(S,{isOpen:p,setIsOpen:r,title:f,trigger:e.jsx(e.Fragment,{}),children:e.jsx("div",{className:"flex flex-row-reverse gap-2",children:e.jsxs("form",{onSubmit:t=>{t.preventDefault(),n&&(o.mutate({payment:{id:n._id,email:n.email,amount:n.amount},reason:u}),r(!1),d(""))},className:"space-y-4 w-full",children:[e.jsx(P,{dir:"rtl",value:u,onChange:t=>d(t.target.value),type:"text",placeholder:"سبب الرفض (مثال: لا يوجد رصيد)",required:!0}),e.jsx(l,{type:"submit",children:"تأكيد الرفض"})]})})}),e.jsx("div",{dir:"rtl",className:"space-y-6",children:e.jsx(k,{title:"تسديدات معلقة",description:"",columns:j,data:g||[],renderRowActions:t=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"default",size:"sm",onClick:()=>{window.confirm("هل انت متأكد من انهاء العملية")&&i.mutate(t._id)},disabled:i.isPending,children:i.isPending?"...":"تأكيد"}),e.jsx(l,{variant:"destructive",size:"sm",onClick:()=>{y(t),r(!0)},disabled:o.isPending,children:o.isPending?"...":"رفض"})]})})})]})}export{G as default};
