import{c as L,r as o,u as re,j as e,a as ie,P as j,b as C,d as ce,e as S,f as le,g as de}from"./index-BDEvpPy0.js";import{u as ue}from"./useQuery-D7kiyVYs.js";import{u as me,a as pe,c as _,R as fe,I as ge,D as xe,U as ve}from"./DashboardLayout-CI8m_gX9.js";import{S as T}from"./StatsCard-BRNmnej6.js";import{C as b}from"./ChartContainer-CdngV_P-.js";import{C as A,a as I,b as B,c as P}from"./card-en6WJuJj.js";import{g as be}from"./wifi-LQWNa4dc.js";import{g as E,a as he}from"./balance-DwEg57Mm.js";import{L as ye,A as je,D as Ne,d as Ce}from"./DatePicker-DWXtYpbw.js";import{g as Te}from"./invoices-BUZBDLLc.js";import{l as Se}from"./index-BLRFddlS.js";import{C as F}from"./credit-card-pa3u-HV0.js";import{D as we}from"./DemoContainer-CgBV-6ZM.js";import"./button-BLetExgu.js";import"./house-B8Ikywws.js";import"./axios-KE4dpIQc.js";import"./index-xsH4HHeE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=L("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=L("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);var w="Tabs",[Me,Je]=ie(w,[_]),K=_(),[Re,D]=Me(w),V=o.forwardRef((a,n)=>{const{__scopeTabs:c,value:l,onValueChange:s,defaultValue:p,orientation:i="horizontal",dir:f,activationMode:x="automatic",...g}=a,m=me(f),[d,v]=re({prop:l,onChange:s,defaultProp:p});return e.jsx(Re,{scope:c,baseId:pe(),value:d,onValueChange:v,orientation:i,dir:m,activationMode:x,children:e.jsx(j.div,{dir:m,"data-orientation":i,...g,ref:n})})});V.displayName=w;var $="TabsList",G=o.forwardRef((a,n)=>{const{__scopeTabs:c,loop:l=!0,...s}=a,p=D($,c),i=K(c);return e.jsx(fe,{asChild:!0,...i,orientation:p.orientation,dir:p.dir,loop:l,children:e.jsx(j.div,{role:"tablist","aria-orientation":p.orientation,...s,ref:n})})});G.displayName=$;var U="TabsTrigger",q=o.forwardRef((a,n)=>{const{__scopeTabs:c,value:l,disabled:s=!1,...p}=a,i=D(U,c),f=K(c),x=O(i.baseId,l),g=Y(i.baseId,l),m=l===i.value;return e.jsx(ge,{asChild:!0,...f,focusable:!s,active:m,children:e.jsx(j.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":g,"data-state":m?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:x,...p,ref:n,onMouseDown:C(a.onMouseDown,d=>{!s&&d.button===0&&d.ctrlKey===!1?i.onValueChange(l):d.preventDefault()}),onKeyDown:C(a.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&i.onValueChange(l)}),onFocus:C(a.onFocus,()=>{const d=i.activationMode!=="manual";!m&&!s&&d&&i.onValueChange(l)})})})});q.displayName=U;var H="TabsContent",z=o.forwardRef((a,n)=>{const{__scopeTabs:c,value:l,forceMount:s,children:p,...i}=a,f=D(H,c),x=O(f.baseId,l),g=Y(f.baseId,l),m=l===f.value,d=o.useRef(m);return o.useEffect(()=>{const v=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(v)},[]),e.jsx(ce,{present:s||m,children:({present:v})=>e.jsx(j.div,{"data-state":m?"active":"inactive","data-orientation":f.orientation,role:"tabpanel","aria-labelledby":x,hidden:!v,id:g,tabIndex:0,...i,ref:n,style:{...a.style,animationDuration:d.current?"0s":void 0},children:v&&p})})});z.displayName=H;function O(a,n){return`${a}-trigger-${n}`}function Y(a,n){return`${a}-content-${n}`}var Ae=V,Q=G,W=q,J=z;const Ie=Ae,Z=o.forwardRef(({className:a,...n},c)=>e.jsx(Q,{ref:c,className:S("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...n}));Z.displayName=Q.displayName;const h=o.forwardRef(({className:a,...n},c)=>e.jsx(W,{ref:c,className:S("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...n}));h.displayName=W.displayName;const y=o.forwardRef(({className:a,...n},c)=>e.jsx(J,{ref:c,className:S("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...n}));y.displayName=J.displayName;function Ze(){const a=le(),n=JSON.parse(localStorage.getItem("DaherUser")),[c,l]=o.useState(0),[s,p]=o.useState([]),[i,f]=o.useState([]),[x,g]=o.useState([]),[m,d]=o.useState(""),[v,X]=o.useState(null),k=de();o.useEffect(()=>{const t=Se("https://paynet-cdji.onrender.com");return X(t),t.on("pendingPaymentsUpdate",r=>{k.setQueryData(["pending-table"],r)}),()=>{t.disconnect()}},[k]);const ee=async()=>{const t=await E("");t!=null&&t.success?g(t.BalanceTable):console.error(t)},te=async()=>{const t=await be();t!=null&&t.success?n.role=="dealer"?p(t.customers.filter(r=>r.dealer==="habeb")):p(t.customers):alert((t==null?void 0:t.error)||"فشل جلب البيانات")},ae=async()=>{const t=await he("");t!=null&&t.success?f(t.BalanceTable):console.log((t==null?void 0:t.error)||"فشل جلب البيانات"),console.log(t)};o.useEffect(()=>{te(),ae(),ee()},[]);const se=o.useMemo(()=>s.reduce((t,r)=>t+Number(r.SubscriptionSpeed),0),[s]),ne=o.useMemo(()=>{const t=s.filter(r=>r.Balance<0).reduce((r,u)=>r+Number(u.Balance),0);return Math.abs(t)},[s]);o.useEffect(()=>{let t=0;i.forEach(r=>{t+=r.total}),l(t)},[i]);const{data:M,isLoading:Be}=ue({queryKey:["pending-table"],queryFn:Te});return e.jsx(xe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Welcome back! Here's what's happening with your business today."})]}),e.jsxs("div",{dir:"rtl",className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(T,{onClick:()=>{a("/users")},title:"عدد مشتركين الفضائي",value:s.length||0,icon:ve}),e.jsx(T,{onClick:()=>{a("/users",{state:"unpaid"})},title:"ديون الفضائي",value:ne||0,icon:F}),e.jsx(T,{onClick:()=>{a("/PendingTransactions")},title:"الفواتير الغير مدفوعة",value:M?M.length:0,icon:ke})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 text-center",children:[e.jsx(b,{className:"mdL:col-span-2",title:" توزع المرسلات ",data:s.reduce((t,r)=>{const u=(r.sender??"").trim(),R=Number(r.SubscriptionSpeed),N=t.find(oe=>oe.sender===u);return N?(N.totalSpeed+=R,N.customerCount+=1):t.push({sender:u,totalSpeed:R,customerCount:1}),t},[]),type:"bar",dataKey2:"customerCount",dataKey:"totalSpeed"}),n.role!="admin"?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsx(b,{title:"صناديق اليوم",data:i,type:"line",dataKey2:"count",desc:c.toString(),dataKey:"total"})}),e.jsx(b,{title:"عدد المشتركين حسب السرعة",type:"pie",dataKey:"value",data:Object.values(s.reduce((t,r)=>{const u=r.SubscriptionSpeed||"غير محددة";return t[u]||(t[u]={name:`${u} Mbps`,value:0}),t[u].value+=1,t},{})),desc:se.toString()+" Mbps"})]}),n.role!="admin"?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsxs(Ie,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(Z,{children:[e.jsx(h,{value:"overview",children:"Overview"}),e.jsx(h,{value:"analytics",children:"Analytics"}),e.jsx(h,{value:"reports",children:"Reports"})]}),e.jsx(y,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs(A,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Active Users"}),e.jsx(De,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(P,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"2,350"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+180.1% from last month"})]})]}),e.jsxs(A,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(P,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"$45,231.89"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+20.1% from last month"})]})]}),e.jsx(b,{title:"Revenue Distribution",data:(s==null?void 0:s.slice(0,4))||[],type:"pie",dataKey:"revenue"})]})}),e.jsx(y,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{className:"bg-background/80 text-foreground",children:e.jsx(ye,{dateAdapter:je,children:e.jsx(we,{components:["DatePicker","DatePicker","DatePicker"],children:e.jsx(Ne,{views:["month","year"],value:Ce(m),onChange:t=>{const r=t.format("YYYY-MM");d(r),E(r).then(u=>{u!=null&&u.success&&g(u.BalanceTable)})}})})})}),e.jsx(b,{title:"صناديق الشهر الحالي",data:x||[],type:"stackBar",dataKey:"users"})]})}),e.jsx(y,{value:"reports",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Reports Coming Soon"}),e.jsx("p",{className:"text-muted-foreground",children:"Advanced reporting features will be available soon."})]})})]})})]})})}export{Ze as default};
