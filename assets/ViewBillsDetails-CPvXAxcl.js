import{p as te,r as c,x as E,j as e,w as y}from"./index-CJDeOR-D.js";import{D as ae}from"./DashboardLayout-y2KXrlW2.js";import{C as R,a as A,b as F,c as L,e as T,d as ne}from"./card-CHhuJT8d.js";import{B as d}from"./button-By_xk0nu.js";import{D as O}from"./DataTable-BowkCNWE.js";import{D as re}from"./DetailsInputs-LAndMJXO.js";import{P as le}from"./PopupForm-wiHTllH-.js";import{I as M}from"./input-GrzhRsEd.js";import{d as ce,L as ie,A as oe,D as de}from"./DatePicker-CZZnoAAo.js";import{P as z}from"./plus-BbnKQPWo.js";import"./house-CfMLYBxw.js";import"./wifi-daava5Pu.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=te("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function ue({initialItems:p=[],products:m=[]}){const[v,f]=c.useState(!0),[u,x]=c.useState([]);c.useEffect(()=>{x(p.map(r=>({...r})))},[p]);const g=E().id,j=(r,l,a)=>{const o=[...u];o[r]={...o[r],[l]:a},x(o)},b=r=>{x(u.filter((l,a)=>a!==r))},N=[{key:"name",label:"Name",sortable:!0},{key:"price",label:"Price",sortable:!0},{key:"category",label:"Category"},{key:"stock",label:"Stock"},{key:"description",label:"Description"}],C=async()=>{var r,l;try{await y.put(`https://paynet-1.onrender.com/api/invoice/add-bill-items/${g}`,{items:u,initialItems:p}),alert("تم حفظ العناصر بنجاح"),f(!1)}catch(a){console.error(a),alert(((l=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:l.message)||"حدث خطأ أثناء الحفظ")}};return e.jsxs("div",{children:[v&&e.jsxs("form",{onSubmit:C,className:"mt-4 space-y-4 p-4 border rounded",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"ادخل بيانات العناصر"}),u.map((r,l)=>e.jsxs("div",{className:"grid grid-cols-4 gap-2 items-center border-b py-2",children:[e.jsx("input",{type:"text",placeholder:"اسم المنتج",value:r.name,onChange:a=>j(l,"name",a.target.value),className:"border p-1 rounded col-span-1"}),e.jsx("input",{type:"number",placeholder:"السعر",value:r.price,onChange:a=>j(l,"price",Number(a.target.value)),className:"border p-1 rounded col-span-1"}),e.jsx("input",{type:"number",placeholder:"الكمية",value:r.stock,onChange:a=>j(l,"stock",Number(a.target.value)),className:"border p-1 rounded col-span-1"}),e.jsx(d,{type:"button",variant:"destructive",size:"sm",onClick:()=>b(l),children:"حذف"})]},l)),e.jsx("div",{className:"flex justify-between mt-2",children:e.jsx(d,{type:"submit",variant:"accent",children:"حفظ العناصر"})})]}),e.jsx("div",{children:m&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-2 mt-4",children:"المنتجات المتاحة"}),e.jsx(O,{title:"Products",description:"All available products",columns:N,data:m,renderRowActions:r=>e.jsx("div",{className:"flex gap-2",children:e.jsx(d,{onClick:()=>{x(l=>{const a=l.findIndex(o=>o._id===r._id);if(a!==-1){const o=[...l];return o[a].stock+=1,o}return[...l,{_id:r._id,name:r.name,price:r.price,stock:1}]})},size:"sm",children:"أضف إلى الفاتورة"})})})]})})]})}function ke(){const p=E().id,[m,v]=c.useState(null),[f,u]=c.useState([]),[x,g]=c.useState(!1),[j,b]=c.useState(!1),[N,C]=c.useState([]),[r,l]=c.useState(!1),[a,o]=c.useState("اضافة دفعة"),[w,U]=c.useState(0),[P,V]=c.useState(ce()),[k,Y]=c.useState(""),[S,I]=c.useState(!1),[q,_]=c.useState(!1),H=c.useRef(null),[G,$]=c.useState([]),J=JSON.parse(localStorage.getItem("DaherUser")),K=()=>{const s=new Date,i={year:"numeric",month:"numeric",day:"numeric",weekday:"long",hour:"numeric",minute:"numeric",second:"numeric"};return s.toLocaleDateString("en-GB",i)},B=async()=>{try{const s=await y.get(`https://paynet-1.onrender.com/api/invoice/viewBills/${p}`);v(s.data),u(s.data.items),$(s.data.payments||[])}catch(s){console.error(s)}},Q=async s=>{var i,n;try{if(!window.confirm("هل انت متاكد من حذف الفاتورة؟"))return;await y.delete(`https://paynet-1.onrender.com/api/invoice/delete-bill-items/${p}/delete-item/${s}`),alert("تم حذف الفاتورة بنجاح"),u(h=>h.filter(D=>D._id!==s))}catch(t){console.error(t),alert(((n=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:n.message)||"حدث خطأ أثناء الحذف")}};c.useEffect(()=>{B()},[p]);const W="https://paynet-1.onrender.com",X=async()=>{var s,i;try{const n=await y.get(`${W}/api/product/get-product`);C(n.data)}catch(n){console.log(n),alert(((i=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:i.message)||"حدث خطأ أثناء الحذف")}},Z=async s=>{var i,n;s.preventDefault();try{I(!0),await y.post(`https://paynet-1.onrender.com/api/invoice/new-payment/${p}`,{amount:w,date:P,details:k,FormTitle:a}),alert("تم إضافة الدفعة بنجاح"),l(!1),B()}catch(t){console.log(t),alert(((n=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:n.message)||"حدث خطأ أثناء إضافة الدفعة")}finally{I(!1)}},ee=async s=>{var i,n;try{if(!window.confirm("هل انت متاكد من حذف الدفعة؟"))return;await y.delete(`https://paynet-1.onrender.com/api/invoice/delete-payment/${p}/delete-payment/${s}`),alert("تم حذف الدفعة بنجاح"),$(h=>h.filter(D=>D._id!==s))}catch(t){console.error(t),alert(((n=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:n.message)||"حدث خطأ أثناء الحذف")}},se=[{key:"amount",label:"المبلغ"},{key:"details",label:"التفاصيل"},{key:"date",label:"التاريخ"}];return c.useEffect(()=>{X()},[]),e.jsxs(ae,{children:[e.jsx(le,{isOpen:r,setIsOpen:l,title:a,trigger:e.jsx(e.Fragment,{}),children:e.jsxs("div",{className:"flex flex-row-reverse gap-2",children:[q?e.jsx(e.Fragment,{}):e.jsxs("form",{onSubmit:Z,className:"space-y-4 w-2/3",children:[e.jsx(M,{value:w,onChange:s=>U(Number(s.target.value)),type:"number",placeholder:"القيمة بالدولار",required:!0}),e.jsx(ie,{dateAdapter:oe,children:e.jsx(de,{className:"w-full",label:"اختر التاريخ",value:P,onChange:s=>V(s),format:"DD/MM/YYYY"})}),e.jsx(M,{value:k,onChange:s=>Y(s.target.value),type:"text",placeholder:"تفاصيل (اختياري)"}),e.jsx("button",{disabled:!!S,type:"submit",className:"w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition",children:S?"جاري حفظ التعديلات ...":"إرسال"})]}),e.jsxs("div",{ref:H,className:"p-4 text-sm",dir:"rtl",children:[e.jsxs("div",{className:"header",children:[e.jsx("h1",{children:"Daher.Net"}),e.jsx("span",{children:K()})]}),e.jsxs("div",{className:"text-right font-bold mb-2",children:[e.jsxs("div",{children:["اسم المشترك: ",(m==null?void 0:m.customerName)||"غير معروف"]}),e.jsxs("div",{children:["الرقم: ",(m==null?void 0:m.customerPhone)||"غير معروف"]})]}),e.jsxs("div",{className:"text-right mb-2",children:[e.jsx("div",{className:"font-semibold",children:"التفاصيل:"}),e.jsx("div",{className:"border p-1 rounded",children:k||"بدون ملاحظات"})]}),e.jsx("div",{className:"text-right totalValue mt-4",children:e.jsxs("div",{className:"text-lg font-extrabold border-t pt-2",children:[a=="اضافة دفعة"?"المبلغ المدفوع":"المبلغ المطلوب",": ",w," دولار"]})}),e.jsx("div",{className:"cut mt-4 border-t pt-2 text-center text-xs",children:"-- شكراً لثقتكم بخدماتنا --"})]})]})}),e.jsxs("div",{className:"text-right",dir:"rtl",children:[e.jsxs(R,{children:[e.jsx(A,{children:e.jsx(F,{children:"المعلومات الأساسية"})}),e.jsxs(L,{className:"",children:[e.jsx(re,{customer:{...m},setCustomer:v}),e.jsxs("div",{className:"flex justify-start gap-2",children:[J.role=="admin"&&e.jsxs(d,{variant:"destructive",onClick:()=>{o("اضافة فاتورة"),_(!1),l(!0)},children:[e.jsx(z,{className:"w-4 h-4 ml-2"})," إضافة فاتورة"]}),e.jsxs(d,{variant:"default",onClick:()=>{o("اضافة دفعة"),_(!1),l(!0)},children:[e.jsx(z,{className:"w-4 h-4 ml-2"})," إضافة دفعة"]}),e.jsx(d,{variant:"outline",children:"واتساب"}),e.jsx(d,{variant:"outline",children:e.jsx(me,{})})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-6",children:f.map((s,i)=>e.jsxs(R,{children:[e.jsxs(A,{children:[e.jsxs(F,{children:["عنصر رقم ",i+1]}),j?e.jsx(T,{children:e.jsx("input",{type:"text",value:s.name,onChange:n=>u(f.map((t,h)=>h===i?{...t,name:n.target.value}:t))})}):e.jsx(T,{children:s.name})]}),e.jsxs(L,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"السعر:"}),j?e.jsx("input",{type:"number",value:s.price,onChange:n=>u(f.map((t,h)=>h===i?{...t,price:Number(n.target.value)}:t))}):e.jsxs("span",{children:[s.price," $"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"الكمية:"}),j?e.jsx("input",{type:"number",value:s.stock,onChange:n=>u(f.map((t,h)=>h===i?{...t,stock:Number(n.target.value)}:t))}):e.jsx("span",{children:s.stock})]}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"المجموع:"}),e.jsxs("span",{children:[s.price*s.stock," $"]})]})]}),e.jsx(ne,{className:"flex justify-end gap-2",children:j?e.jsx(d,{size:"sm",variant:"accent",onClick:()=>b(!1),children:"حفظ التعديلات"}):e.jsx(d,{onClick:()=>Q(s._id),size:"sm",variant:"destructive",children:"حذف العنصر"})})]},s._id))}),e.jsxs("div",{className:"mt-4",children:[e.jsx(d,{variant:"secondary",onClick:()=>g(!x),children:x?"إلغاء":"اضافة عنصر جديد"}),x&&e.jsx(ue,{initialItems:f,products:N})]}),e.jsx(O,{className:"my-4",title:"الفواتير",description:"جميع الفواتير المسجلة",columns:se,data:G,getRowClassName:s=>s.FormTitle==="اضافة دفعة"?"text-green-500":"text-red-500",renderRowActions:s=>e.jsx("div",{className:"flex gap-2",children:e.jsx(d,{onClick:()=>ee(s._id),variant:"destructive",children:"حذف"})})})]})]})}export{ke as default};
