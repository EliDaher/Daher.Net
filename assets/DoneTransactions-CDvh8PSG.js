import{r as a,i as O,j as e}from"./index-CJDeOR-D.js";import{D as x}from"./DashboardLayout-y2KXrlW2.js";import{D as q}from"./DataTable-BowkCNWE.js";import{P as A,a as I,b as P,C as V}from"./popover-D4rEXKXf.js";import{B}from"./button-By_xk0nu.js";import{C as $,a as z,c as F}from"./card-CHhuJT8d.js";import{S as f,a as p,b as j,c as b,d as l}from"./select-ChE2awgR.js";import{b as H}from"./invoices-DscnKQao.js";import"./house-CfMLYBxw.js";import"./input-GrzhRsEd.js";import"./index-CpB6iu1S.js";import"./index-CvbHSxH-.js";function se(){const[s,C]=a.useState(void 0),[n,g]=a.useState("all"),[i,w]=a.useState("all"),[c,D]=a.useState("all"),[m,K]=a.useState(""),u=s!=null&&s.from?new Date(s.from.getTime()+Math.abs(s.from.getTimezoneOffset()*6e4)).toISOString().split("T")[0]:"",d=s!=null&&s.to?new Date(s.to.getTime()+Math.abs(s.to.getTimezoneOffset()*6e4)).toISOString().split("T")[0]:"",{data:o=[],isLoading:T,isError:N}=O({queryKey:["done-invoices",u,d],queryFn:()=>H(u,d),enabled:!!u&&!!d}),h=a.useMemo(()=>o.filter(t=>n==="all"?!0:t.company===n).filter(t=>c==="all"?!0:t.status===c).filter(t=>i==="all"?!0:t.email===i).filter(t=>{var y,S,v;if(!m)return!0;const r=m.toLowerCase();return((y=t.landline)==null?void 0:y.toLowerCase().includes(r))||((S=t.email)==null?void 0:S.toLowerCase().includes(r))||((v=t.note)==null?void 0:v.toLowerCase().includes(r))}),[o,n,i,c,m]),k=[{key:"_id",label:"المعرف",sortable:!0,hidden:!0},{key:"landline",label:"الرقم",sortable:!0},{key:"company",label:"الشركة",sortable:!0},{key:"speed",label:"السرعة",sortable:!0},{key:"email",label:"الحساب المرسل",sortable:!0},{key:"amount",label:"المبلغ المسدد",sortable:!0},{key:"status",label:"حالة العملية",sortable:!0},{key:"paymentMethod",label:"طريقة الدفع",sortable:!0},{key:"note",label:"ملاحظات",sortable:!0},{key:"createdAt",label:"تاريخ العملية",sortable:!0}],L=a.useMemo(()=>{const t=new Set;return o.forEach(r=>{r.company&&t.add(r.company)}),Array.from(t)},[o]),M=a.useMemo(()=>{const t=new Set;return o.forEach(r=>{r.email&&t.add(r.email)}),Array.from(t)},[o]),E=a.useMemo(()=>h.reduce((t,r)=>(r.amount&&(t+=r.amount),t),0),[h]);return T?e.jsx(x,{children:e.jsx("div",{dir:"rtl",className:"flex h-[70vh] items-center justify-center text-lg font-semibold",children:"جارِ تحميل البيانات..."})}):N?e.jsx(x,{children:e.jsx("div",{dir:"rtl",className:"flex h-[70vh] items-center justify-center text-red-600 text-lg font-semibold",children:"حدث خطأ أثناء تحميل البيانات"})}):e.jsx(x,{children:e.jsxs("div",{dir:"rtl",className:"space-y-6",children:[e.jsxs($,{className:"p-2 space-y-4",children:[e.jsx(z,{className:"text-3xl font-semibold",children:"الفلاتر"}),e.jsxs(F,{className:"flex flex-wrap gap-4",children:[e.jsxs(f,{value:n,onValueChange:g,children:[e.jsx(p,{className:"w-40",children:e.jsx(j,{placeholder:"الشركة"})}),e.jsxs(b,{children:[e.jsx(l,{value:"all",children:"الكل"}),L.map(t=>e.jsx(l,{value:t,children:t},t))]})]}),e.jsxs(f,{value:i,onValueChange:w,children:[e.jsx(p,{className:"w-40",children:e.jsx(j,{placeholder:"الشركة"})}),e.jsxs(b,{children:[e.jsx(l,{value:"all",children:"الكل"}),M.map(t=>e.jsx(l,{value:t,children:t},t))]})]}),e.jsxs(f,{value:c,onValueChange:D,children:[e.jsx(p,{className:"w-40",children:e.jsx(j,{placeholder:"الحالة"})}),e.jsxs(b,{children:[e.jsx(l,{value:"all",children:"الكل"}),e.jsx(l,{value:"تم التسديد",children:"تم التسديد"}),e.jsx(l,{value:"غير مسددة",children:"غير مسددة"}),e.jsx(l,{value:"مرفوضة",children:"مرفوضة"})]})]}),e.jsxs(A,{children:[e.jsx(I,{asChild:!0,children:e.jsx(B,{variant:"outline",className:"whitespace-nowrap",children:s!=null&&s.from&&(s!=null&&s.to)?`من ${u} إلى ${d}`:"اختر المدة الزمنية"})}),e.jsx(P,{className:"w-auto p-0",align:"start",children:e.jsx(V,{initialFocus:!0,mode:"range",selected:s,onSelect:C,numberOfMonths:2})})]})]})]}),e.jsx(q,{title:"التسديدات المنتهية",description:`إجمالي المبلغ: ${E.toLocaleString()}`,columns:k,data:h})]})})}export{se as default};
